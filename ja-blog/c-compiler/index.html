<!doctype html><html lang=en><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<style>:root{--accent-color:#FF4D4D}</style>
<title>CでCコンパイラを書いた</title>
<meta name=description content="MAKE THE WORLD FUN AGAIN">
<meta name=keywords content="blog,diohabara,hugo,c,compiler">
<meta property="og:url" content="https://diohabara.github.io/ja-blog/c-compiler/">
<meta property="og:type" content="website">
<meta property="og:title" content="CでCコンパイラを書いた">
<meta property="og:description" content="MAKE THE WORLD FUN AGAIN">
<meta property="og:image" content="/images/avatar.jpg">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:title content="CでCコンパイラを書いた">
<meta name=twitter:description content="MAKE THE WORLD FUN AGAIN">
<meta property="twitter:domain" content="https://diohabara.github.io/ja-blog/c-compiler/">
<meta property="twitter:url" content="https://diohabara.github.io/ja-blog/c-compiler/">
<meta name=twitter:image content="/images/avatar.jpg">
<link rel=canonical href=https://diohabara.github.io/ja-blog/c-compiler/>
<link rel=stylesheet type=text/css href=https://diohabara.github.io/css/normalize.min.css media=print onload="this.media='all'">
<link rel=stylesheet type=text/css href=https://diohabara.github.io/css/main.css>
<link disabled id=dark-theme rel=stylesheet href=https://diohabara.github.io/css/dark.css>
<script src=https://diohabara.github.io/js/svg-injector.min.js></script>
<script src=https://diohabara.github.io/js/feather-icons.min.js></script>
<script src=https://diohabara.github.io/js/main.js></script>
</head>
<body>
<script type=text/javascript>setThemeByUserPref()</script><header class=header>
<nav class=header-nav>
<div class=avatar>
<a href=https://diohabara.github.io>
<img src=https://diohabara.github.io/images/avatar.jpg alt=avatar>
</a>
</div>
<div class=nav-title>
<a class=nav-brand href=https://diohabara.github.io>barabara diary</a>
</div>
<div class=nav-links>
<div class=nav-link>
<a href=https://diohabara.github.io/ja-blog/><span data-feather=map-pin></span> ブログ </a>
</div>
<div class=nav-link>
<a href=https://diohabara.github.io/en-blog/><span data-feather=globe></span> blog </a>
</div>
<div class=nav-link>
<a href=https://diohabara.github.io/tags/> Tags </a>
</div>
<div class=nav-link>
<a href=https://github.com/diohabara/><span data-feather=github></span> </a>
</div>
<div class=nav-link>
<a href=https://diohabara.github.io/index.xml><span data-feather=rss></span> </a>
</div>
<span class=nav-icons-divider></span>
<div class="nav-link dark-theme-toggle">
<a>
<span id=theme-toggle-icon data-feather=moon></span>
</a>
</div>
<div class=nav-link id=hamburger-menu-toggle>
<a>
<span data-feather=menu></span>
</a>
</div>
<ul class="nav-hamburger-list visibility-hidden">
<li class=nav-item>
<a href=https://diohabara.github.io/ja-blog/><span data-feather=map-pin></span> ブログ </a>
</li>
<li class=nav-item>
<a href=https://diohabara.github.io/en-blog/><span data-feather=globe></span> blog </a>
</li>
<li class=nav-item>
<a href=https://diohabara.github.io/tags/> Tags </a>
</li>
<li class=nav-item>
<a href=https://github.com/diohabara/><span data-feather=github></span> </a>
</li>
<li class=nav-item>
<a href=https://diohabara.github.io/index.xml><span data-feather=rss></span> </a>
</li>
<li class="nav-item dark-theme-toggle">
<a>
<span id=theme-toggle-icon data-feather=moon></span>
</a>
</li>
</ul>
</div>
</nav>
</header>
<main id=content>
<div class="post container">
<div class=post-header-section>
<h1>CでCコンパイラを書いた</h1>
<small role=doc-subtitle></small>
<p class=post-date>
July 19, 2022
</p>
<ul class=post-tags>
<li class=post-tag><a href=https://diohabara.github.io/tags/c>c</a></li>
<li class=post-tag><a href=https://diohabara.github.io/tags/compiler>compiler</a></li>
</ul>
</div>
<div class=post-content>
<p>
<ul>
<li><a href=#3-%E8%A1%8C%E3%81%BE%E3%81%A8%E3%82%81>3 行まとめ</a></li>
<li><a href=#%E4%BD%95%E3%82%92%E3%81%97%E3%81%9F>何をした？</a></li>
<li><a href=#%E3%81%AA%E3%81%9C%E3%82%84%E3%81%A3%E3%81%9F>なぜやった？</a></li>
<li><a href=#%E5%BE%97%E3%81%9F%E3%82%82%E3%81%AE>得たもの</a></li>
<li><a href=#%E6%AC%A1%E3%81%AB%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8>次にやりたいこと</a></li>
<li><a href=#%E8%AC%9D%E8%BE%9E>謝辞</a></li>
<li><a href=#%E5%8F%82%E7%85%A7>参照</a></li>
</ul>
<p>
<img src=/images/The_C_Programming_Language_logo.svg alt=c>
</p>
<h2 id=3-行まとめ>3 行まとめ <a href=#3-%e8%a1%8c%e3%81%be%e3%81%a8%e3%82%81>#</a></h2><ul>
<li>C で C コンパイラを書いた</li>
<li>大学で一応コンパイラを書いたが理解していなかったので確認のため</li>
<li>次は別のアセンブリ、言語で書きたい</li>
</ul>
<h2 id=何をした>何をした？ <a href=#%e4%bd%95%e3%82%92%e3%81%97%e3%81%9f>#</a></h2><p><a href=https://www.sigbus.info/compilerbook>Rui Ueyama 氏の書いたコンパイラに関する記事</a>と<a href=https://github.com/rui314/chibicc/>関連レポジトリ</a>を元に<a href=https://github.com/diohabara/ccc>C コンパイラ</a>を書いた。正確には参照用のブランチを見て写経をした。途中までは要件から自分で書いていたのだが、途中バグって数日を無駄にしたので学習目的と割り切って写経に切り替えた。</p>
<h2 id=なぜやった>なぜやった？ <a href=#%e3%81%aa%e3%81%9c%e3%82%84%e3%81%a3%e3%81%9f>#</a></h2><p>コンパイラを書いたことがなかったから。コンパイラとは一般に「字句解析 → 構文解析 → 意味解析 → コード生成」するソフトだろう。自分は今までコード生成、つまりアセンブリのコードを出力するところをやったことがなかった。</p>
<p>一応大学の講義でやった&mldr;ということになっているのだが、よくわからず適当に動かしていたらテストケースが通っていたという感じである。だから理解をしながらやったのは今回が初めてとなる。</p>
<h2 id=得たもの>得たもの <a href=#%e5%be%97%e3%81%9f%e3%82%82%e3%81%ae>#</a></h2><p>C で C のコンパイラを書くという内容だったが、C で C のコンパイラが書くことも分解すれば単純なことの繰り返しだということがわかってよかった。しかし、Rui Ueyama 氏の参考コードを読むと単純なことなのに実装するまで気付かない解決策が多い。ここらへんはやはり自分で何度も手を動かしたり、他人のコードを盗むしかないのだと思う。</p>
<p>インターンが中心になるとコードを書く行数が減るので意識してコードを書こうと思った。</p>
<h2 id=次にやりたいこと>次にやりたいこと <a href=#%e6%ac%a1%e3%81%ab%e3%82%84%e3%82%8a%e3%81%9f%e3%81%84%e3%81%93%e3%81%a8>#</a></h2><p>次はアセンブリ(Arm、RISC-V)について勉強をするか、Rust について勉強をして Rust でコンパイラを書いてみたいと思った。</p>
<p>前者に関しては、この記事だと x86-64 が使われていたのですが別のアセンブリも触ってみたいから。後者に関しては、C ではなくて現代的機能を持ったシステムプログラミング言語を触ってみたいから。</p>
<h2 id=謝辞>謝辞 <a href=#%e8%ac%9d%e8%be%9e>#</a></h2><p>このような記事を書いてくれた Rui Ueyama 氏に感謝。</p>
<h2 id=参照>参照 <a href=#%e5%8f%82%e7%85%a7>#</a></h2><ul>
<li><a href=https://www.sigbus.info/compilerbook>https://www.sigbus.info/compilerbook</a></li>
<li><a href=https://github.com/rui314/chibicc/commits/reference>https://github.com/rui314/chibicc/commits/reference</a></li>
</ul>
</p>
</div>
</div>
</main><footer class=footer>
<span>&copy; 2022 </span>
<span>
Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a>
</span>
</footer>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.6/css/all.css>
<link rel=stylesheet href=/css/custom.css>
<section class="section sns_parent">
<div class="container sns_section">
<div class="sns_button twitter">
<a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fdiohabara.github.io%2fja-blog%2fc-compiler%2f&text=C%e3%81%a7C%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%a9%e3%82%92%e6%9b%b8%e3%81%84%e3%81%9f" target=_blank title=Tweet><i class="fab fa-twitter"></i></a>
</div>
<div class="sns_button hatena">
<a href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fdiohabara.github.io%2fja-blog%2fc-compiler%2f&title=C%e3%81%a7C%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%a9%e3%82%92%e6%9b%b8%e3%81%84%e3%81%9f" target=_blank title=hatena><i class="fa fa-hatena"></i></i></a>
</div>
<div class="sns_button facebook">
<a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiohabara.github.io%2fja-blog%2fc-compiler%2f&t=C%e3%81%a7C%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%a9%e3%82%92%e6%9b%b8%e3%81%84%e3%81%9f" target=_blank title=Facebook><i class="fab fa-facebook"></i></a>
</div>
<div class="sns_button pocket">
<a href="http://getpocket.com/edit?url=https%3a%2f%2fdiohabara.github.io%2fja-blog%2fc-compiler%2f&title=C%e3%81%a7C%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%a9%e3%82%92%e6%9b%b8%e3%81%84%e3%81%9f" target=_blank title=pocket><i class="fab fa-get-pocket"></i></a>
</div>
</div>
</section>
</body>
</html>