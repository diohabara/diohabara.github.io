---
interface Props {
  type: 'home' | 'article';
  title?: string;
  description?: string;
  url?: string;
  image?: string;
  datePublished?: string;
  dateModified?: string;
  tags?: string[];
  wordCount?: number;
  parentTitle?: string;
  parentUrl?: string;
}

const {
  type,
  title = 'barabara diary',
  description = 'MAKE THE WORLD FUN AGAIN',
  url,
  image,
  datePublished,
  dateModified,
  tags = [],
  wordCount,
  parentTitle,
  parentUrl,
} = Astro.props;

const siteUrl = Astro.site?.href ?? 'https://diohabara.github.io';
const author = 'diohabara';
const pageUrl = url || Astro.url.href;
const resolvedImage = image
  ? new URL(image.startsWith('/') ? image : `/${image}`, Astro.site).href
  : new URL('/img/avatar.jpg', Astro.site).href;

const personSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: author,
  url: siteUrl,
  description: 'MAKE THE WORLD FUN AGAIN',
  sameAs: ['https://twitter.com/diohabara'],
};

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  url: siteUrl,
  name: 'barabara diary',
  description: 'MAKE THE WORLD FUN AGAIN',
  author: { '@type': 'Person', name: author },
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${siteUrl}search/?q={search_term_string}`,
    },
    'query-input': 'required name=search_term_string',
  },
};

const blogPostingSchema = type === 'article' ? {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: title,
  name: title,
  url: pageUrl,
  description,
  keywords: tags.join(', '),
  wordCount,
  datePublished,
  dateModified: dateModified || datePublished,
  author: { '@type': 'Person', name: author, url: siteUrl },
  publisher: {
    '@type': 'Person',
    name: author,
    logo: { '@type': 'ImageObject', url: resolvedImage },
  },
  mainEntityOfPage: { '@type': 'WebPage', '@id': pageUrl },
  inLanguage: 'ja',
  ...(image ? { image: { '@type': 'ImageObject', url: resolvedImage } } : {}),
} : null;

const breadcrumbItems = [
  { '@type': 'ListItem', position: 1, name: 'Home', item: siteUrl },
];
if (parentTitle && parentUrl) {
  breadcrumbItems.push({ '@type': 'ListItem', position: 2, name: parentTitle, item: parentUrl });
  breadcrumbItems.push({ '@type': 'ListItem', position: 3, name: title, item: pageUrl });
} else if (type !== 'home') {
  breadcrumbItems.push({ '@type': 'ListItem', position: 2, name: title, item: pageUrl });
}

const breadcrumbSchema = type !== 'home' ? {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: breadcrumbItems,
} : null;
---

{type === 'home' && (
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
)}
{blogPostingSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(blogPostingSchema)} />
)}
{breadcrumbSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
)}
<script type="application/ld+json" set:html={JSON.stringify(personSchema)} />
