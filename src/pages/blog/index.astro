---
import Layout from '../../layouts/Layout.astro';
import PostCard from '../../components/PostCard.astro';
import LanguageFilter from '../../components/LanguageFilter.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const jaCount = posts.filter((p) => p.data.language === 'ja').length;
const enCount = posts.filter((p) => p.data.language === 'en').length;
---

<Layout title="Blog" description="All blog posts">
  <h1>Blog</h1>
  <LanguageFilter jCount={jaCount} enCount={enCount} totalCount={posts.length} />
  <ul class="post-list">
    {posts.map((post) => (
      <PostCard
        title={post.data.title}
        date={post.data.date}
        slug={post.id}
        tags={post.data.tags}
        language={post.data.language}
      />
    ))}
  </ul>
</Layout>
