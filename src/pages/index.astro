---
import Layout from '../layouts/Layout.astro';
import PostCard from '../components/PostCard.astro';
import LanguageFilter from '../components/LanguageFilter.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const recentPosts = posts.slice(0, 20);
const jaCount = posts.filter((p) => p.data.language === 'ja').length;
const enCount = posts.filter((p) => p.data.language === 'en').length;
---

<Layout title="barabara diary" description="MAKE THE WORLD FUN AGAIN" schemaType="home">
  <section>
    <p>MAKE THE WORLD FUN AGAIN</p>
    <h2>Recent Posts</h2>
    <LanguageFilter jCount={jaCount} enCount={enCount} totalCount={posts.length} />
    <ul class="post-list">
      {recentPosts.map((post) => (
        <PostCard
          title={post.data.title}
          date={post.data.date}
          slug={post.id}
          tags={post.data.tags}
          language={post.data.language}
        />
      ))}
    </ul>
    {posts.length > 20 && (
      <p><a href="/blog/">View all posts â†’</a></p>
    )}
  </section>
</Layout>
