---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).filter((p) => !p.data.draft);

const tagMap = new Map<string, number>();
for (const post of posts) {
  for (const tag of post.data.tags) {
    if (tag) tagMap.set(tag, (tagMap.get(tag) ?? 0) + 1);
  }
}

const sortedTags = [...tagMap.entries()].sort((a, b) => b[1] - a[1]);
---

<Layout title="Tags" description="All tags">
  <h1>Tags</h1>
  <div class="tag-cloud">
    {sortedTags.map(([tag, count]) => (
      <a class="tag" href={`/tags/${tag}/`}>
        {tag} ({count})
      </a>
    ))}
  </div>
</Layout>
