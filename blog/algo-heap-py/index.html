<!DOCTYPE html><html lang="ja"> <head><script>
      (function() {
        var stored = localStorage.getItem('theme');
        var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (stored === 'dark' || (!stored && prefersDark)) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Pythonã®heapq(Heap)ã«ã¤ã„ã¦ | barabara diary</title><meta name="description" content="MAKE THE WORLD FUN AGAIN"><meta name="keywords" content="blog, diohabara, memo, python, algorithm, heap, heapq"><meta property="og:url" content="https://diohabara.github.io/blog/algo-heap-py/"><meta property="og:type" content="article"><meta property="og:title" content="Pythonã®heapq(Heap)ã«ã¤ã„ã¦ | barabara diary"><meta property="og:description" content="MAKE THE WORLD FUN AGAIN"><meta property="og:image" content="https://diohabara.github.io/img/avatar.jpg"><meta property="article:published_time" content="2026-02-09T11:00:00.000Z"><meta property="article:modified_time" content="2026-02-09T11:00:00.000Z"><meta property="article:author" content="diohabara"><meta property="article:tag" content="memo"><meta property="article:tag" content="python"><meta property="article:tag" content="algorithm"><meta property="article:tag" content="heap"><meta property="article:tag" content="heapq"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Pythonã®heapq(Heap)ã«ã¤ã„ã¦ | barabara diary"><meta name="twitter:description" content="MAKE THE WORLD FUN AGAIN"><meta name="twitter:site" content="@diohabara"><meta name="twitter:creator" content="@diohabara"><meta name="twitter:image" content="https://diohabara.github.io/img/avatar.jpg"><link rel="canonical" href="https://diohabara.github.io/blog/algo-heap-py/"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="sitemap" href="/sitemap-index.xml"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" title="barabara diary" href="/rss.xml"><script async src="https://www.googletagmanager.com/gtag/js?id=G-JC4F65F0RT"></script><script>(function(){const gaId = "G-JC4F65F0RT";

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', gaId);
    })();</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Pythonã®heapq(Heap)ã«ã¤ã„ã¦","name":"Pythonã®heapq(Heap)ã«ã¤ã„ã¦","url":"https://diohabara.github.io/blog/algo-heap-py/","description":"MAKE THE WORLD FUN AGAIN","keywords":"memo, python, algorithm, heap, heapq","wordCount":5493,"datePublished":"2026-02-09T11:00:00.000Z","dateModified":"2026-02-09T11:00:00.000Z","author":{"@type":"Person","name":"diohabara","url":"https://diohabara.github.io/"},"publisher":{"@type":"Person","name":"diohabara","logo":{"@type":"ImageObject","url":"https://diohabara.github.io/img/avatar.jpg"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diohabara.github.io/blog/algo-heap-py/"},"inLanguage":"ja"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://diohabara.github.io/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://diohabara.github.io/blog/"},{"@type":"ListItem","position":3,"name":"Pythonã®heapq(Heap)ã«ã¤ã„ã¦","item":"https://diohabara.github.io/blog/algo-heap-py/"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"diohabara","url":"https://diohabara.github.io/","description":"MAKE THE WORLD FUN AGAIN","sameAs":["https://twitter.com/diohabara"]}</script><link rel="stylesheet" href="/_astro/_slug_.DV60zqMk.css"></head> <body> <a class="skip-link" href="#content">Skip to content</a> <header class="site-header"> <h1><a href="/">barabara diary</a></h1> <nav class="site-nav"> <a href="/blog/"> Blog </a><a href="/compensation/"> Compensation </a><a href="/tags/"> Tags </a><a href="https://github.com/diohabara/" target="_blank" rel="noopener noreferrer"> GitHub </a><a href="/search/"> Search </a><a href="/rss.xml"> RSS </a> <button class="dark-toggle" id="dark-toggle" aria-label="Toggle dark mode"> <span id="theme-icon">ğŸŒ™</span> </button> </nav> </header> <script type="module">function s(){const n=document.getElementById("dark-toggle"),t=document.getElementById("theme-icon");if(!n||!t)return;const e=document.documentElement,a=e.classList.contains("dark");t.textContent=a?"â˜€ï¸":"ğŸŒ™",requestAnimationFrame(()=>{e.classList.add("transitions-ready")}),n.addEventListener("click",()=>{const o=e.classList.toggle("dark");localStorage.setItem("theme",o?"dark":"light"),t.textContent=o?"â˜€ï¸":"ğŸŒ™"})}s();document.addEventListener("astro:after-swap",s);</script> <main id="content">  <article class="has-sidenotes"> <header class="article-header"> <h1>Pythonã®heapq(Heap)ã«ã¤ã„ã¦</h1> <div class="post-meta"> <time datetime="2026-02-09T11:00:00.000Z">2026/02/09</time> <span class="post-tags"> <a class="tag" href="/tags/memo/">memo</a><a class="tag" href="/tags/python/">python</a><a class="tag" href="/tags/algorithm/">algorithm</a><a class="tag" href="/tags/heap/">heap</a><a class="tag" href="/tags/heapq/">heapq</a> </span> </div> </header> <nav class="toc"> <details open> <summary>ç›®æ¬¡</summary> <ul> <li class> <a href="#ãƒ’ãƒ¼ãƒ—ã¨ã¯">ãƒ’ãƒ¼ãƒ—ã¨ã¯</a> </li><li class="toc-h3"> <a href="#å®Œå…¨äºŒåˆ†æœ¨ã¨é…åˆ—è¡¨ç¾">å®Œå…¨äºŒåˆ†æœ¨ã¨é…åˆ—è¡¨ç¾</a> </li><li class="toc-h3"> <a href="#è¨ˆç®—é‡">è¨ˆç®—é‡</a> </li><li class="toc-h3"> <a href="#pushè¦ç´ ã®è¿½åŠ ">pushï¼ˆè¦ç´ ã®è¿½åŠ ï¼‰</a> </li><li class="toc-h3"> <a href="#popæœ€å°è¦ç´ ã®å–ã‚Šå‡ºã—">popï¼ˆæœ€å°è¦ç´ ã®å–ã‚Šå‡ºã—ï¼‰</a> </li><li class="toc-h3"> <a href="#heapifyé…åˆ—ã®ãƒ’ãƒ¼ãƒ—åŒ–">heapifyï¼ˆé…åˆ—ã®ãƒ’ãƒ¼ãƒ—åŒ–ï¼‰</a> </li><li class> <a href="#tldr">TL;DR</a> </li><li class> <a href="#heapqã¨ã¯">heapqã¨ã¯</a> </li><li class> <a href="#æä¾›ã•ã‚Œã‚‹ä¸»ãªapi">æä¾›ã•ã‚Œã‚‹ä¸»ãªAPI</a> </li><li class="toc-h3"> <a href="#max-heap-apipython-314">max-heap APIï¼ˆPython 3.14+ï¼‰</a> </li><li class> <a href="#å®Ÿè£…ã®é›°å›²æ°—æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª">å®Ÿè£…ã®é›°å›²æ°—ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰</a> </li><li class> <a href="#ä½¿ã„æ–¹ã®åŸºæœ¬">ä½¿ã„æ–¹ã®åŸºæœ¬</a> </li><li class="toc-h3"> <a href="#1-æœ€å°ã‚’å–ã‚Šå‡ºã™å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ã®æœ€å°ç‰ˆ">1) æœ€å°ã‚’å–ã‚Šå‡ºã™ï¼ˆå„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ã®æœ€å°ç‰ˆï¼‰</a> </li><li class="toc-h3"> <a href="#2-æ—¢å­˜ãƒªã‚¹ãƒˆã‚’ãƒ’ãƒ¼ãƒ—åŒ–ã—ã¦ã‹ã‚‰ä½¿ã†">2) æ—¢å­˜ãƒªã‚¹ãƒˆã‚’ãƒ’ãƒ¼ãƒ—åŒ–ã—ã¦ã‹ã‚‰ä½¿ã†</a> </li><li class> <a href="#ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹--ãƒãƒã‚Šã©ã“ã‚">ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹ / ãƒãƒã‚Šã©ã“ã‚</a> </li><li class="toc-h3"> <a href="#ç©ºãƒ’ãƒ¼ãƒ—ã«å¯¾ã™ã‚‹pop">ç©ºãƒ’ãƒ¼ãƒ—ã«å¯¾ã™ã‚‹pop</a> </li><li class="toc-h3"> <a href="#æ¯”è¼ƒã§ããªã„è¦ç´ ã‚’æ··ãœã‚‹ã¨è½ã¡ã‚‹">æ¯”è¼ƒã§ããªã„è¦ç´ ã‚’æ··ãœã‚‹ã¨è½ã¡ã‚‹</a> </li><li class> <a href="#å…·ä½“ä¾‹1-ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰top-kå›ºå®šã‚µã‚¤ã‚ºãƒ’ãƒ¼ãƒ—">å…·ä½“ä¾‹1: ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰Top-Kï¼ˆå›ºå®šã‚µã‚¤ã‚ºãƒ’ãƒ¼ãƒ—ï¼‰</a> </li><li class> <a href="#å…·ä½“ä¾‹2-å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼åŒç‚¹å‡¦ç†å‰Šé™¤æ›´æ–°">å…·ä½“ä¾‹2: å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼ï¼ˆåŒç‚¹å‡¦ç†ãƒ»å‰Šé™¤ãƒ»æ›´æ–°ï¼‰</a> </li><li class> <a href="#å…·ä½“ä¾‹3-ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®è¤‡æ•°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒãƒ¼ã‚¸heapqmerge">å…·ä½“ä¾‹3: ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®è¤‡æ•°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒãƒ¼ã‚¸ï¼ˆheapq.mergeï¼‰</a> </li><li class> <a href="#å…·ä½“ä¾‹4-ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ä¸­å¤®å€¤2ãƒ’ãƒ¼ãƒ—">å…·ä½“ä¾‹4: ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ä¸­å¤®å€¤ï¼ˆ2ãƒ’ãƒ¼ãƒ—ï¼‰</a> </li><li class> <a href="#cpythonã®å®Ÿè£…">CPythonã®å®Ÿè£…</a> </li><li class="toc-h3"> <a href="#å…¨ä½“æ§‹æˆ-pythonãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨cå®Ÿè£…">å…¨ä½“æ§‹æˆ: Pythonãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨Cå®Ÿè£…</a> </li><li class="toc-h3"> <a href="#siftã®å‘½åã«ã¤ã„ã¦">siftã®å‘½åã«ã¤ã„ã¦</a> </li><li class="toc-h3"> <a href="#_siftdown-è¦ªã‚’ä¸‹ã«ãµã‚‹ã„è½ã¨ã—ã¦è¦ç´ ã‚’æ ¹æ–¹å‘ã¸ä¸Šã’ã‚‹">_siftdown: è¦ªã‚’ä¸‹ã«ãµã‚‹ã„è½ã¨ã—ã¦ã€è¦ç´ ã‚’æ ¹æ–¹å‘ã¸ä¸Šã’ã‚‹</a> </li><li class="toc-h3"> <a href="#_siftup-å­ã‚’ä¸Šã«ãµã‚‹ã„ä¸Šã’ã¦è¦ç´ ã‚’è‘‰æ–¹å‘ã¸ä¸‹ã’ã‚‹--knuthã®æœ€é©åŒ–">_siftup: å­ã‚’ä¸Šã«ãµã‚‹ã„ä¸Šã’ã¦ã€è¦ç´ ã‚’è‘‰æ–¹å‘ã¸ä¸‹ã’ã‚‹ â€” Knuthã®æœ€é©åŒ–</a> </li><li class="toc-h3"> <a href="#heapify-ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—æ§‹ç¯‰ãŒonã«ãªã‚‹ç†ç”±">heapify: ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—æ§‹ç¯‰ãŒO(n)ã«ãªã‚‹ç†ç”±</a> </li><li class="toc-h3"> <a href="#heappushpopã¨heapreplace-ãªãœåˆ†ã‘ã¦ã„ã‚‹ã‹">heappushpopã¨heapreplace: ãªãœåˆ†ã‘ã¦ã„ã‚‹ã‹</a> </li><li class="toc-h3"> <a href="#nsmallestnlargest-3ã¤ã®æˆ¦ç•¥">nsmallest/nlargest: 3ã¤ã®æˆ¦ç•¥</a> </li><li class="toc-h3"> <a href="#merge-ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹k-wayãƒãƒ¼ã‚¸">merge: ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹k-wayãƒãƒ¼ã‚¸</a> </li><li class="toc-h3"> <a href="#cå®Ÿè£…_heapqmodulecã¨ã®é•ã„">Cå®Ÿè£…ï¼ˆ_heapqmodule.cï¼‰ã¨ã®é•ã„</a> </li><li class> <a href="#ã¾ã¨ã‚">ã¾ã¨ã‚</a> </li><li class> <a href="#references">References</a> </li> </ul> </details> </nav> <div class="article-content">  <h2 id="ãƒ’ãƒ¼ãƒ—ã¨ã¯">ãƒ’ãƒ¼ãƒ—ã¨ã¯<a aria-hidden="true" tabindex="-1" href="#ãƒ’ãƒ¼ãƒ—ã¨ã¯"><span class="icon icon-link"></span></a></h2>
<p>ãƒ’ãƒ¼ãƒ—ï¼ˆheapï¼‰ã¯å®Œå…¨äºŒåˆ†æœ¨ã®å½¢ã‚’ã—ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã€ã€Œè¦ªã¯å¸¸ã«å­ä»¥ä¸‹ï¼ˆor ä»¥ä¸Šï¼‰ã€ã¨ã„ã†å±€æ‰€çš„ãªå¤§å°é–¢ä¿‚ã ã‘ã‚’ä¿è¨¼ã™ã‚‹ã€‚</p>
<ul>
<li>min-heap: è¦ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â‰¤</mo></mrow><annotation encoding="application/x-tex">\leq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">â‰¤</span></span></span></span> å­ã€‚æ ¹ãŒå¸¸ã«æœ€å°</li>
<li>max-heap: è¦ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â‰¥</mo></mrow><annotation encoding="application/x-tex">\geq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">â‰¥</span></span></span></span> å­ã€‚æ ¹ãŒå¸¸ã«æœ€å¤§</li>
</ul>
<p>ã€Œãƒ’ãƒ¼ãƒ— â‰  ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã€ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã€‚ä¿è¨¼ã•ã‚Œã‚‹ã®ã¯è¦ªå­é–“ã®é–¢ä¿‚ã ã‘ã§ã€å…„å¼Ÿé–“ã®é †åºã¯ä¸å®šã€‚</p>
<h3 id="å®Œå…¨äºŒåˆ†æœ¨ã¨é…åˆ—è¡¨ç¾">å®Œå…¨äºŒåˆ†æœ¨ã¨é…åˆ—è¡¨ç¾<a aria-hidden="true" tabindex="-1" href="#å®Œå…¨äºŒåˆ†æœ¨ã¨é…åˆ—è¡¨ç¾"><span class="icon icon-link"></span></a></h3>
<p>ãƒ’ãƒ¼ãƒ—ã¯å®Œå…¨äºŒåˆ†æœ¨ï¼ˆæœ€ä¸‹æ®µä»¥å¤–ã¯ã™ã¹ã¦åŸ‹ã¾ã‚Šã€æœ€ä¸‹æ®µã¯å·¦è©°ã‚ï¼‰ãªã®ã§ã€ãƒã‚¤ãƒ³ã‚¿ãªã—ã§é…åˆ—ã«è¼‰ã›ã‚‰ã‚Œã‚‹ã€‚0å§‹ã¾ã‚Šã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹<code>k</code>ã«å¯¾ã—ã¦:</p>
<ul>
<li>å·¦ã®å­: <code>2*k + 1</code></li>
<li>å³ã®å­: <code>2*k + 2</code></li>
<li>è¦ª: <code>(k - 1) // 2</code></li>
</ul>
<p>min-heapã®ä¾‹ï¼ˆé…åˆ—: <code>[1, 2, 3, 5, 4, 7]</code>ï¼‰</p>
<pre class="mermaid">graph TD
    A["[0] 1"]
    B["[1] 2"]
    C["[2] 3"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]

    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- G:::hidden

    classDef hidden display:none</pre>
<ul>
<li><code>heap[1]=2</code> ã®å­ã¯ <code>heap[3]=5</code>, <code>heap[4]=4</code> â†’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>â‰¤</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">2 \leq 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>â‰¤</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">2 \leq 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> âœ“</li>
<li><code>heap[2]=3</code> ã®å­ã¯ <code>heap[5]=7</code> â†’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>â‰¤</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">3 \leq 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span></span></span></span> âœ“</li>
<li>å…„å¼Ÿã® 5 ã¨ 4ã€å¾“å…„å¼Ÿã® 4 ã¨ 7 ã®é–“ã«é †åºã®ä¿è¨¼ã¯ãªã„</li>
</ul>
<h3 id="è¨ˆç®—é‡">è¨ˆç®—é‡<a aria-hidden="true" tabindex="-1" href="#è¨ˆç®—é‡"><span class="icon icon-link"></span></a></h3>



































<table><thead><tr><th>æ“ä½œ</th><th>è¨ˆç®—é‡</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>peekï¼ˆæœ€å°/æœ€å¤§ã®å‚ç…§ï¼‰</td><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></td><td><code>heap[0]</code>ã‚’è¦‹ã‚‹ã ã‘</td></tr><tr><td>push</td><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td>æœ«å°¾ã«è¿½åŠ ã—ã¦æ ¹æ–¹å‘ã¸ä¸ŠãŒã‚‹ï¼ˆæœ¨ã®é«˜ã•åˆ†ï¼‰</td></tr><tr><td>pop</td><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td>æ ¹ã‚’å–ã‚Šå‡ºã—ã€æœ«å°¾è¦ç´ ã‚’æ ¹ã«ç½®ã„ã¦è‘‰æ–¹å‘ã¸ä¸‹ã’ã‚‹</td></tr><tr><td>heapifyï¼ˆé…åˆ—â†’ãƒ’ãƒ¼ãƒ—ï¼‰</td><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td>ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—æ§‹ç¯‰</td></tr><tr><td>ä»»æ„è¦ç´ ã®æ¤œç´¢</td><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td><td>é †åºã®ä¿è¨¼ãŒå±€æ‰€çš„ãªã®ã§ç·šå½¢æ¢ç´¢ã™ã‚‹ã—ã‹ãªã„</td></tr></tbody></table>
<p>ã€Œæœ€å°ï¼ˆæœ€å¤§ï¼‰ã‚’é«˜é€Ÿã«å‡ºã—å…¥ã‚Œã™ã‚‹ã€ã®ãŒãƒ’ãƒ¼ãƒ—ã®å­˜åœ¨æ„ç¾©ã§ã‚ã‚Šã€å…¨ä½“ã®ã‚½ãƒ¼ãƒˆã‚„ä»»æ„è¦ç´ ã®æ¤œç´¢ã«ã¯å‘ã‹ãªã„ã€‚</p>
<h3 id="pushè¦ç´ ã®è¿½åŠ ">pushï¼ˆè¦ç´ ã®è¿½åŠ ï¼‰<a aria-hidden="true" tabindex="-1" href="#pushè¦ç´ ã®è¿½åŠ "><span class="icon icon-link"></span></a></h3>
<p>æ–°ã—ã„è¦ç´ ã‚’æœ«å°¾ã«è¿½åŠ ã—ã€è¦ªã¨æ¯”è¼ƒã—ãªãŒã‚‰ä¸Šã«ç§»å‹•ï¼ˆbubble upï¼‰ã™ã‚‹ã€‚è¦ªã‚ˆã‚Šå°ã•ã‘ã‚Œã°å…¥ã‚Œæ›¿ãˆã€è¦ªä»¥ä¸Šã«ãªã‚‹ã‹æ ¹ã«é”ã—ãŸã‚‰åœæ­¢ã€‚</p>
<p>ä¾‹: <code>[1, 2, 3, 5, 4, 7]</code>ã«<code>0</code>ã‚’push</p>
<p>step 1. æœ«å°¾ã«è¿½åŠ  â†’ <code>[1, 2, 3, 5, 4, 7, 0]</code></p>
<pre class="mermaid">graph TD
    A["[0] 1"]
    B["[1] 2"]
    C["[2] 3"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]
    H["[6] 0 â† new"]

    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- H

    style H fill:#ffcccc</pre>
<p>step 2. <code>0 &#x3C; 3</code>ï¼ˆè¦ªï¼‰ãªã®ã§å…¥ã‚Œæ›¿ãˆ â†’ <code>[1, 2, 0, 5, 4, 7, 3]</code></p>
<pre class="mermaid">graph TD
    A["[0] 1"]
    B["[1] 2"]
    C["[2] 0 â†‘"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]
    H["[6] 3"]

    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- H

    style C fill:#ffcccc</pre>
<p>step 3. <code>0 &#x3C; 1</code>ï¼ˆè¦ªï¼‰ãªã®ã§å…¥ã‚Œæ›¿ãˆ â†’ <code>[0, 2, 1, 5, 4, 7, 3]</code>ã€‚æ ¹ã«åˆ°é”ã€çµ‚äº†ã€‚</p>
<pre class="mermaid">graph TD
    A["[0] 0 â† done"]
    B["[1] 2"]
    C["[2] 1"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]
    H["[6] 3"]

    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- H

    style A fill:#ccffcc</pre>
<p>æœ¨ã®é«˜ã•ã¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">âŒŠ</mo><msub><mrow><mi>log</mi><mo>â¡</mo></mrow><mn>2</mn></msub><mi>n</mi><mo stretchy="false">âŒ‹</mo></mrow><annotation encoding="application/x-tex">\lfloor \log_2 n \rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">âŒŠ</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">âŒ‹</span></span></span></span> ãªã®ã§ã€æœ€å¤§ã§ã‚‚ãã®å›æ•°ã—ã‹å…¥ã‚Œæ›¿ãˆãŒèµ·ããªã„ â†’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ã€‚</p>
<h3 id="popæœ€å°è¦ç´ ã®å–ã‚Šå‡ºã—">popï¼ˆæœ€å°è¦ç´ ã®å–ã‚Šå‡ºã—ï¼‰<a aria-hidden="true" tabindex="-1" href="#popæœ€å°è¦ç´ ã®å–ã‚Šå‡ºã—"><span class="icon icon-link"></span></a></h3>
<p>æ ¹ï¼ˆæœ€å°ï¼‰ã‚’å–ã‚Šå‡ºã—ã€æœ«å°¾è¦ç´ ã‚’æ ¹ã«ç½®ã„ã¦ã‹ã‚‰å­ã¨æ¯”è¼ƒã—ãªãŒã‚‰ä¸‹ã«ç§»å‹•ï¼ˆbubble downï¼‰ã™ã‚‹ã€‚å­ã®ã†ã¡å°ã•ã„æ–¹ã¨å…¥ã‚Œæ›¿ãˆã€å­ä»¥ä¸‹ã«ãªã‚‹ã‹è‘‰ã«é”ã—ãŸã‚‰åœæ­¢ã€‚</p>
<p>ä¾‹: <code>[1, 2, 3, 5, 4, 7]</code>ã‹ã‚‰pop</p>
<p>step 1. æ ¹<code>1</code>ã‚’å–ã‚Šå‡ºã—ã€æœ«å°¾<code>7</code>ã‚’æ ¹ã« â†’ <code>[7, 2, 3, 5, 4]</code></p>
<pre class="mermaid">graph TD
    A["[0] 7 â† from tail"]
    B["[1] 2"]
    C["[2] 3"]
    D["[3] 5"]
    E["[4] 4"]

    A --- B
    A --- C
    B --- D
    B --- E

    style A fill:#ffcccc</pre>
<p>step 2. å­ã¯<code>2</code>ã¨<code>3</code>ã€‚å°ã•ã„æ–¹<code>2</code>ã¨æ¯”è¼ƒ â†’ <code>7 > 2</code>ãªã®ã§å…¥ã‚Œæ›¿ãˆ â†’ <code>[2, 7, 3, 5, 4]</code></p>
<pre class="mermaid">graph TD
    A["[0] 2"]
    B["[1] 7 â†“"]
    C["[2] 3"]
    D["[3] 5"]
    E["[4] 4"]

    A --- B
    A --- C
    B --- D
    B --- E

    style B fill:#ffcccc</pre>
<p>step 3. å­ã¯<code>5</code>ã¨<code>4</code>ã€‚å°ã•ã„æ–¹<code>4</code>ã¨æ¯”è¼ƒ â†’ <code>7 > 4</code>ãªã®ã§å…¥ã‚Œæ›¿ãˆ â†’ <code>[2, 4, 3, 5, 7]</code></p>
<pre class="mermaid">graph TD
    A["[0] 2"]
    B["[1] 4"]
    C["[2] 3"]
    D["[3] 5"]
    E["[4] 7 â† done"]

    A --- B
    A --- C
    B --- D
    B --- E

    style E fill:#ccffcc</pre>
<p>è‘‰ã«åˆ°é”ã€çµ‚äº†ã€‚è¿”ã‚Šå€¤ã¯<code>1</code>ã€‚pushã¨åŒæ§˜ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ã€‚</p>
<h3 id="heapifyé…åˆ—ã®ãƒ’ãƒ¼ãƒ—åŒ–">heapifyï¼ˆé…åˆ—ã®ãƒ’ãƒ¼ãƒ—åŒ–ï¼‰<a aria-hidden="true" tabindex="-1" href="#heapifyé…åˆ—ã®ãƒ’ãƒ¼ãƒ—åŒ–"><span class="icon icon-link"></span></a></h3>
<p>ä»»æ„ã®é…åˆ—ã‚’ãƒ’ãƒ¼ãƒ—ã«å¤‰æ›ã™ã‚‹ã€‚ã€Œè‘‰ã¯æ—¢ã«ãƒ’ãƒ¼ãƒ—æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ã€æœ€å¾Œã®éè‘‰ãƒãƒ¼ãƒ‰ã‹ã‚‰æ ¹ã«å‘ã‹ã£ã¦é †ã«bubble downã‚’é©ç”¨ã™ã‚‹ã€‚</p>
<p>ä¾‹: <code>[5, 1, 3, 2, 4]</code>ã‚’heapify</p>
<p>åˆæœŸçŠ¶æ…‹ï¼ˆãƒ’ãƒ¼ãƒ—æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ãªã„ï¼‰:</p>
<pre class="mermaid">graph TD
    A["[0] 5"]
    B["[1] 1"]
    C["[2] 3"]
    D["[3] 2"]
    E["[4] 4"]

    A --- B
    A --- C
    B --- D
    B --- E</pre>
<p>æœ€å¾Œã®éè‘‰ãƒãƒ¼ãƒ‰ã¯ <code>index = n//2 - 1 = 5//2 - 1 = 1</code>ã€‚ã“ã“ã‹ã‚‰æ ¹ï¼ˆindex 0ï¼‰ã«å‘ã‹ã£ã¦é †ã«bubble downã‚’é©ç”¨ã™ã‚‹ã€‚è‘‰ãƒãƒ¼ãƒ‰ï¼ˆindex 2, 3, 4ï¼‰ã¯å­ã‚’æŒãŸãªã„ã®ã§å‡¦ç†ä¸è¦ã€‚</p>
<p>step 1. index 1ã‚’å‡¦ç†: <code>heap[1]=1</code>ã®å­ã¯ <code>heap[3]=2</code> ã¨ <code>heap[4]=4</code>ã€‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1 \leq 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> ã‹ã¤ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">1 \leq 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> ãªã®ã§æ—¢ã«ãƒ’ãƒ¼ãƒ—æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ â†’ å¤‰æ›´ãªã—</p>
<pre class="mermaid">graph TD
    A["[0] 5"]
    B["[1] 1 â† check"]
    C["[2] 3"]
    D["[3] 2"]
    E["[4] 4"]

    A --- B
    A --- C
    B --- D
    B --- E

    style B fill:#ccffcc</pre>
<p>step 2. index 0ã‚’å‡¦ç†: <code>heap[0]=5</code>ã®å­ã¯ <code>heap[1]=1</code> ã¨ <code>heap[2]=3</code>ã€‚å°ã•ã„æ–¹ã®å­ <code>1</code> ã¨æ¯”è¼ƒ â†’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>></mo><mn>1</mn></mrow><annotation encoding="application/x-tex">5 > 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> ãªã®ã§å…¥ã‚Œæ›¿ãˆ â†’ <code>[1, 5, 3, 2, 4]</code></p>
<pre class="mermaid">graph TD
    A["[0] 1"]
    B["[1] 5 â†“"]
    C["[2] 3"]
    D["[3] 2"]
    E["[4] 4"]

    A --- B
    A --- C
    B --- D
    B --- E

    style A fill:#ccffcc
    style B fill:#ffcccc</pre>
<p>step 3. bubble downã®ç¶šã: <code>heap[1]=5</code>ã®å­ã¯ <code>heap[3]=2</code> ã¨ <code>heap[4]=4</code>ã€‚å°ã•ã„æ–¹ã®å­ <code>2</code> ã¨æ¯”è¼ƒ â†’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>></mo><mn>2</mn></mrow><annotation encoding="application/x-tex">5 > 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> ãªã®ã§å…¥ã‚Œæ›¿ãˆ â†’ <code>[1, 2, 3, 5, 4]</code>ã€‚<code>heap[3]=5</code>ã¯è‘‰ãªã®ã§çµ‚äº†</p>
<pre class="mermaid">graph TD
    A["[0] 1"]
    B["[1] 2"]
    C["[2] 3"]
    D["[3] 5 â† done"]
    E["[4] 4"]

    A --- B
    A --- C
    B --- D
    B --- E

    style A fill:#ccffcc
    style B fill:#ccffcc</pre>
<p>ãªãœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> ã‹: è‘‰ï¼ˆç´„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">n/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord">/2</span></span></span></span> å€‹ï¼‰ã¯å‡¦ç†ä¸è¦ã€ãã®1ã¤ä¸Šã®å±¤ï¼ˆç´„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">n/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord">/4</span></span></span></span> å€‹ï¼‰ã¯é«˜ã•1ã€ã•ã‚‰ã«ä¸Šï¼ˆç´„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">n/8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord">/8</span></span></span></span> å€‹ï¼‰ã¯é«˜ã•2â€¦ã¨ã€å‡¦ç†é‡ã®åˆè¨ˆã¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>h</mi><mo>=</mo><mn>0</mn></mrow><mrow><mo stretchy="false">âŒŠ</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">âŒ‹</mo></mrow></msubsup><mfrac><mi>n</mi><msup><mn>2</mn><mrow><mi>h</mi><mo>+</mo><mn>1</mn></mrow></msup></mfrac><mo>â‹…</mo><mi>h</mi><mo>â‰ˆ</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\sum_{h=0}^{\lfloor \log n \rfloor} \frac{n}{2^{h+1}} \cdot h \approx n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4022em;vertical-align:-0.3574em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3987em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">âŒŠ</span><span class="mop mtight"><span class="mtight">l</span><span class="mtight">o</span><span class="mtight" style="margin-right:0.01389em;">g</span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">âŒ‹</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.6426em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.782em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3574em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> ã«ãªã‚‹ã€‚1ã¤ãšã¤<code>push</code>ã™ã‚‹æ–¹å¼ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼‰ã‚ˆã‚ŠåŠ¹ç‡çš„ã€‚</p>
<h2 id="tldr">TL;DR<a aria-hidden="true" tabindex="-1" href="#tldr"><span class="icon icon-link"></span></a></h2>
<ul>
<li><code>heapq</code>ã¯ã€Œæœ€å°å€¤ï¼ˆå„ªå…ˆåº¦ãŒæœ€å°ï¼‰ã€ã‚’é«˜é€Ÿã«å–ã‚Šå‡ºã›ã‚‹æœ€å°ãƒ’ãƒ¼ãƒ—(min-heap)ã‚’ã€æ™®é€šã®<code>list</code>ä¸Šã§æ‰±ã†æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</li>
<li><code>heapify</code>ã¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ã€<code>heappush/heappop</code>ã¯åŸºæœ¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></li>
<li>Python 3.14ã‹ã‚‰<code>heapify_max/heappush_max/heappop_max</code>ãªã©max-heap APIãŒè¿½åŠ ã•ã‚ŒãŸï¼ˆãã‚Œä»¥å‰ã¯è² æ•°åŒ–ãªã©ã§ç–‘ä¼¼max-heapãŒå®šç•ªï¼‰</li>
</ul>
<h2 id="heapqã¨ã¯">heapqã¨ã¯<a aria-hidden="true" tabindex="-1" href="#heapqã¨ã¯"><span class="icon icon-link"></span></a></h2>
<p><code>heapq</code>ã¯ã€Œãƒ’ãƒ¼ãƒ—ã‚­ãƒ¥ãƒ¼ï¼ˆå„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ï¼‰ã€ã®å®Ÿè£…ã€‚ãƒ’ãƒ¼ãƒ—ã¯è¦ªãŒå­ä»¥ä¸‹ã«ãªã‚‹äºŒåˆ†æœ¨ï¼ˆmin-heapï¼‰ã§ã€é…åˆ—ï¼ˆPythonã®<code>list</code>ï¼‰ã§è¡¨ã™ã€‚å…·ä½“çš„ã«ã¯ã€0å§‹ã¾ã‚Šã®é…åˆ—<code>heap</code>ã«å¯¾ã—ã¦</p>
<ul>
<li><code>heap[k] &#x3C;= heap[2*k+1]</code></li>
<li><code>heap[k] &#x3C;= heap[2*k+2]</code></li>
</ul>
<p>ãŒæˆã‚Šç«‹ã¤ã‚ˆã†ã«ä¸¦ã¹ã‚‹ï¼ˆå­˜åœ¨ã—ãªã„å­ã¯ç„¡è¦–ï¼‰ã€‚ã“ã®ã¨ãæœ€å°è¦ç´ ã¯å¿…ãš<code>heap[0]</code>ã«æ¥ã‚‹ã€‚</p>
<p>é‡è¦ãªã®ã¯ã€Œãƒ’ãƒ¼ãƒ— = ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã€ã§ã¯ãªã„ã“ã¨ã€‚ä¿è¨¼ã•ã‚Œã‚‹ã®ã¯è¦ªå­ã®å±€æ‰€çš„ãªå¤§å°é–¢ä¿‚ã ã‘ã§ã€å…¨ä½“ã¨ã—ã¦æ˜‡é †ã«ãªã£ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã€‚</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> heapq</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">a </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span><span style="color:#AE81FF">5</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">3</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">4</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">heapq.heapify(a)</span></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">(a)       </span><span style="color:#88846F"># ä¾‹ãˆã° [1, 2, 3, 5, 4] ã®ã‚ˆã†ã«ãªã‚‹</span></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">(a[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">])    </span><span style="color:#88846F"># 1ï¼ˆæœ€å°ã¯å…ˆé ­ï¼‰</span></span></code></pre>
<p>ã¾ãŸã€<code>list.sort()</code>ã¨åŒæ§˜ã«æ¯”è¼ƒã¯<code>&#x3C;</code>ã®ã¿ã‚’ä½¿ã†ï¼ˆ= keyæŠ½å‡ºã®ä»•çµ„ã¿ã¯åŸºæœ¬æŒãŸãªã„ï¼‰ã®ã§ã€å„ªå…ˆåº¦ä»˜ãã«ã—ãŸã„å ´åˆã¯<code>(priority, item)</code>ã®ã‚ˆã†ãªã‚¿ãƒ—ãƒ«ã§decorateã™ã‚‹ã®ãŒå®šç•ªã€‚</p>
<h2 id="æä¾›ã•ã‚Œã‚‹ä¸»ãªapi">æä¾›ã•ã‚Œã‚‹ä¸»ãªAPI<a aria-hidden="true" tabindex="-1" href="#æä¾›ã•ã‚Œã‚‹ä¸»ãªapi"><span class="icon icon-link"></span></a></h2>
<p>min-heapï¼ˆé€šå¸¸ã®<code>heapq</code>ï¼‰ã®ä¸»è¦é–¢æ•°ã¯ä»¥ä¸‹ã€‚</p>
<ul>
<li><code>heapify(x)</code>: ãƒªã‚¹ãƒˆã‚’in-placeã§ãƒ’ãƒ¼ãƒ—åŒ–ï¼ˆç·šå½¢æ™‚é–“ï¼‰</li>
<li><code>heappush(heap, item)</code>: pushï¼ˆãƒ’ãƒ¼ãƒ—æ¡ä»¶ç¶­æŒã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼‰</li>
<li><code>heappop(heap)</code>: æœ€å°ã‚’popï¼ˆç©ºãªã‚‰<code>IndexError</code>ã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼‰</li>
<li><code>heappushpop(heap, item)</code>: pushã—ã¦ã™ãpopï¼ˆåˆ¥ã€…ã«å‘¼ã¶ã‚ˆã‚ŠåŠ¹ç‡çš„ï¼‰</li>
<li><code>heapreplace(heap, item)</code>: æœ€å°ã‚’popã—ã¦<code>item</code>ã‚’pushï¼ˆã‚µã‚¤ã‚ºå›ºå®šå‘ã‘ï¼‰</li>
<li><code>merge(*iterables, key=None, reverse=False)</code>: ã‚½ãƒ¼ãƒˆæ¸ˆã¿åˆ—ã®ãƒãƒ¼ã‚¸ï¼ˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼‰</li>
<li><code>nsmallest / nlargest</code>: ä¸Šä½nä»¶ã‚’æŠœãå‡ºã™</li>
</ul>
<h3 id="max-heap-apipython-314">max-heap APIï¼ˆPython 3.14+ï¼‰<a aria-hidden="true" tabindex="-1" href="#max-heap-apipython-314"><span class="icon icon-link"></span></a></h3>
<p>Python 3.14ã‹ã‚‰ã€max-heapå‘ã‘ã«<code>*_max</code>ç³»ãŒå…¬é–‹APIã¨ã—ã¦è¿½åŠ ã•ã‚ŒãŸã€‚</p>
<ul>
<li><code>heapify_max(x)</code></li>
<li><code>heappush_max(heap, item)</code></li>
<li><code>heappop_max(heap)</code></li>
<li><code>heappushpop_max(heap, item)</code></li>
<li><code>heapreplace_max(heap, item)</code></li>
</ul>
<p>ãã‚Œä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€Œå€¤ã‚’è² ã«ã™ã‚‹ã€ã€Œ<code>(-priority, item)</code>ã«ã™ã‚‹ã€ãªã©ã§ç–‘ä¼¼max-heapã«ã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚</p>
<h2 id="å®Ÿè£…ã®é›°å›²æ°—æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª">å®Ÿè£…ã®é›°å›²æ°—ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰<a aria-hidden="true" tabindex="-1" href="#å®Ÿè£…ã®é›°å›²æ°—æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª"><span class="icon icon-link"></span></a></h2>
<p>å®Ÿè£…ã®æ ¸ã¯ã€Œæœ«å°¾ã«è¿½åŠ ã—ã¦è¦ªæ–¹å‘ã¸ä¸Šã’ã‚‹ï¼ˆsiftdownï¼‰ã€ã¨ã€Œæ ¹ã«æŒã£ã¦ããŸè¦ç´ ã‚’å­æ–¹å‘ã¸ä¸‹ã’ã‚‹ï¼ˆsiftupï¼‰ã€ã®2ã¤ã€‚<code>heappush/heappop</code>ã¯ãã‚Œã‚’å‘¼ã‚“ã§ã„ã‚‹ã ã‘ã€‚</p>
<details>
<summary>heappush / heappop / heapifyï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®pure Pythonå®Ÿè£…ä¾‹ï¼‰</summary>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappush</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    heap.append(item)</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftdown(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF">len</span><span style="color:#F8F8F2">(heap)</span><span style="color:#F92672">-</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappop</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    lastelt </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap.pop()            </span><span style="color:#88846F"># ç©ºãªã‚‰IndexError</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> heap:</span></span>
<span class="line"><span style="color:#F8F8F2">        returnitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">        heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> lastelt</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> returnitem</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> lastelt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heapify</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">x</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    n </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(x)</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> reversed</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(n</span><span style="color:#F92672">//</span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">)):</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup(x, i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftdown</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">startpos</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> pos </span><span style="color:#F92672">></span><span style="color:#F8F8F2"> startpos:</span></span>
<span class="line"><span style="color:#F8F8F2">        parentpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> (pos </span><span style="color:#F92672">-</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">) </span><span style="color:#F92672">>></span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">        parent </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[parentpos]</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> newitem </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> parent:</span></span>
<span class="line"><span style="color:#F8F8F2">            heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parent</span></span>
<span class="line"><span style="color:#F8F8F2">            pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parentpos</span></span>
<span class="line"><span style="color:#F92672">            continue</span></span>
<span class="line"><span style="color:#F92672">        break</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftup</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    endpos </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(heap)</span></span>
<span class="line"><span style="color:#F8F8F2">    startpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> pos</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]</span></span>
<span class="line"><span style="color:#F8F8F2">    childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos:</span></span>
<span class="line"><span style="color:#F8F8F2">        rightpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> rightpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos </span><span style="color:#F92672">and</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> heap[childpos] </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> heap[rightpos]:</span></span>
<span class="line"><span style="color:#F8F8F2">            childpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> rightpos</span></span>
<span class="line"><span style="color:#F8F8F2">        heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[childpos]</span></span>
<span class="line"><span style="color:#F8F8F2">        pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos</span></span>
<span class="line"><span style="color:#F8F8F2">        childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftdown(heap, startpos, pos)</span></span></code></pre>
</details>
<p>ã“ã®ã€Œä¸Šä¸‹ã«å‹•ã‹ã—ã¦å±€æ‰€æ¡ä»¶ã‚’å›å¾©ã™ã‚‹ã€ã‹ã‚‰ã€push/popã¯æœ¨ã®é«˜ã•ã¶ã‚“ï¼ˆãŠã‚ˆã<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>â¡</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\log n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼‰ã ã‘å‹•ãã€ç†è«–çš„ã«<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ã«ãªã‚‹ã€‚</p>
<h2 id="ä½¿ã„æ–¹ã®åŸºæœ¬">ä½¿ã„æ–¹ã®åŸºæœ¬<a aria-hidden="true" tabindex="-1" href="#ä½¿ã„æ–¹ã®åŸºæœ¬"><span class="icon icon-link"></span></a></h2>
<h3 id="1-æœ€å°ã‚’å–ã‚Šå‡ºã™å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ã®æœ€å°ç‰ˆ">1) æœ€å°ã‚’å–ã‚Šå‡ºã™ï¼ˆå„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ã®æœ€å°ç‰ˆï¼‰<a aria-hidden="true" tabindex="-1" href="#1-æœ€å°ã‚’å–ã‚Šå‡ºã™å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ã®æœ€å°ç‰ˆ"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> heapq</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">h </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#F8F8F2">heapq.heappush(h, </span><span style="color:#AE81FF">5</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">heapq.heappush(h, </span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">heapq.heappush(h, </span><span style="color:#AE81FF">3</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">(h[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">])               </span><span style="color:#88846F"># 1ï¼ˆpeekã¯heap[0]ï¼‰</span></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">(heapq.heappop(h))   </span><span style="color:#88846F"># 1</span></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">(heapq.heappop(h))   </span><span style="color:#88846F"># 3</span></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">(heapq.heappop(h))   </span><span style="color:#88846F"># 5</span></span></code></pre>
<h3 id="2-æ—¢å­˜ãƒªã‚¹ãƒˆã‚’ãƒ’ãƒ¼ãƒ—åŒ–ã—ã¦ã‹ã‚‰ä½¿ã†">2) æ—¢å­˜ãƒªã‚¹ãƒˆã‚’ãƒ’ãƒ¼ãƒ—åŒ–ã—ã¦ã‹ã‚‰ä½¿ã†<a aria-hidden="true" tabindex="-1" href="#2-æ—¢å­˜ãƒªã‚¹ãƒˆã‚’ãƒ’ãƒ¼ãƒ—åŒ–ã—ã¦ã‹ã‚‰ä½¿ã†"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> heapq</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">a </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span><span style="color:#AE81FF">5</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">3</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">4</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">heapq.heapify(a)          </span><span style="color:#88846F"># in-place</span></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">([heapq.heappop(a) </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> _ </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> range</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">len</span><span style="color:#F8F8F2">(a))])</span></span>
<span class="line"><span style="color:#88846F"># popã—ç¶šã‘ã‚‹ã¨æ˜‡é †ã§å‡ºã¦ãã‚‹</span></span></code></pre>
<p>ã“ã‚Œã¯ãƒ’ãƒ¼ãƒ—ã‚½ãƒ¼ãƒˆã ãŒã€<code>sorted()</code>ã¨é•ã£ã¦ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã¯ãªã„ï¼ˆåŒå€¤ã®ç›¸å¯¾é †ãŒä¿æŒã•ã‚Œãªã„ï¼‰ã€‚</p>
<h2 id="ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹--ãƒãƒã‚Šã©ã“ã‚">ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹ / ãƒãƒã‚Šã©ã“ã‚<a aria-hidden="true" tabindex="-1" href="#ã‚³ãƒ¼ãƒŠãƒ¼ã‚±ãƒ¼ã‚¹--ãƒãƒã‚Šã©ã“ã‚"><span class="icon icon-link"></span></a></h2>
<h3 id="ç©ºãƒ’ãƒ¼ãƒ—ã«å¯¾ã™ã‚‹pop">ç©ºãƒ’ãƒ¼ãƒ—ã«å¯¾ã™ã‚‹pop<a aria-hidden="true" tabindex="-1" href="#ç©ºãƒ’ãƒ¼ãƒ—ã«å¯¾ã™ã‚‹pop"><span class="icon icon-link"></span></a></h3>
<p><code>heappop([])</code>ã¯<code>IndexError</code>ã€‚</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> heapq</span></span>
<span class="line"><span style="color:#F8F8F2">h </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#88846F"># heapq.heappop(h)  # IndexError</span></span></code></pre>
<h3 id="æ¯”è¼ƒã§ããªã„è¦ç´ ã‚’æ··ãœã‚‹ã¨è½ã¡ã‚‹">æ¯”è¼ƒã§ããªã„è¦ç´ ã‚’æ··ãœã‚‹ã¨è½ã¡ã‚‹<a aria-hidden="true" tabindex="-1" href="#æ¯”è¼ƒã§ããªã„è¦ç´ ã‚’æ··ãœã‚‹ã¨è½ã¡ã‚‹"><span class="icon icon-link"></span></a></h3>
<p><code>heapq</code>ã¯æ¯”è¼ƒã«<code>&#x3C;</code>ã—ã‹ä½¿ã‚ãªã„ã®ã§ã€è¦ç´ åŒå£«ãŒæ¯”è¼ƒä¸èƒ½ã ã¨<code>TypeError</code>ã«ãªã‚ŠãŒã¡ã€‚
å…¸å‹ã¯ã€Œå„ªå…ˆåº¦ãŒåŒã˜ã¨ãã«ç¬¬2è¦ç´ ï¼ˆtaskæœ¬ä½“ï¼‰ã®æ¯”è¼ƒã«è¡Œã£ã¦ã—ã¾ã†ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚</p>
<h2 id="å…·ä½“ä¾‹1-ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰top-kå›ºå®šã‚µã‚¤ã‚ºãƒ’ãƒ¼ãƒ—">å…·ä½“ä¾‹1: ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰Top-Kï¼ˆå›ºå®šã‚µã‚¤ã‚ºãƒ’ãƒ¼ãƒ—ï¼‰<a aria-hidden="true" tabindex="-1" href="#å…·ä½“ä¾‹1-ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰top-kå›ºå®šã‚µã‚¤ã‚ºãƒ’ãƒ¼ãƒ—"><span class="icon icon-link"></span></a></h2>
<p>ã€Œå·¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ä¸Šä½Kä»¶ã ã‘æ¬²ã—ã„ã€ã¯ã€ã‚µã‚¤ã‚ºKã®ãƒ’ãƒ¼ãƒ—ã‚’ç¶­æŒã™ã‚‹ã¨ãƒ¡ãƒ¢ãƒªO(K)ã§æ¸ˆã‚€ã€‚</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> heapq</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> topk_largest</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">iterable</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">k</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    it </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> iter</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F8F8F2">    h </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> _ </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> range</span><span style="color:#F8F8F2">(k):</span></span>
<span class="line"><span style="color:#F92672">        try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">            heapq.heappush(h, </span><span style="color:#66D9EF">next</span><span style="color:#F8F8F2">(it))</span></span>
<span class="line"><span style="color:#F92672">        except</span><span style="color:#66D9EF;font-style:italic"> StopIteration</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">            return</span><span style="color:#66D9EF"> sorted</span><span style="color:#F8F8F2">(h, </span><span style="color:#FD971F;font-style:italic">reverse</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # h[0] ãŒã€Œä»Šã®Top-Kã®ä¸­ã§æœ€å°ã€</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> x </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> it:</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> x </span><span style="color:#F92672">></span><span style="color:#F8F8F2"> h[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]:</span></span>
<span class="line"><span style="color:#F8F8F2">            heapq.heapreplace(h, x)   </span><span style="color:#88846F"># pop+pushã‚’1å›ã§</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#66D9EF"> sorted</span><span style="color:#F8F8F2">(h, </span><span style="color:#FD971F;font-style:italic">reverse</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">)</span></span></code></pre>
<p><code>heapreplace</code>ã¯ã€Œå¿…ãšpopã—ã¦ã‹ã‚‰pushã€ãªã®ã§ã‚µã‚¤ã‚ºå›ºå®šã«å‘ãã€‚ä¸€æ–¹ã€<code>heappushpop</code>ã¯ã€Œå°ã•ã„æ–¹ã‚’è¿”ã—ã¦å¤§ãã„æ–¹ã‚’æ®‹ã™ã€æŒ™å‹•ãªã®ã§ã€æ¡ä»¶æ¬¡ç¬¬ã§ä½¿ã„åˆ†ã‘ã‚‹ï¼ˆå·®ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ãŒã‚ã‚‹ï¼‰ã€‚</p>
<h2 id="å…·ä½“ä¾‹2-å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼åŒç‚¹å‡¦ç†å‰Šé™¤æ›´æ–°">å…·ä½“ä¾‹2: å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼ï¼ˆåŒç‚¹å‡¦ç†ãƒ»å‰Šé™¤ãƒ»æ›´æ–°ï¼‰<a aria-hidden="true" tabindex="-1" href="#å…·ä½“ä¾‹2-å„ªå…ˆåº¦ã‚­ãƒ¥ãƒ¼åŒç‚¹å‡¦ç†å‰Šé™¤æ›´æ–°"><span class="icon icon-link"></span></a></h2>
<p>å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ã‚’å®Ÿæˆ¦æŠ•å…¥ã™ã‚‹ã¨ã€æ¬¡ã®å•é¡ŒãŒå‡ºã‚‹ã€‚</p>
<ul>
<li>åŒã˜å„ªå…ˆåº¦ã®é †åºï¼ˆå®‰å®šæ€§ï¼‰ã‚’ã©ã†ã™ã‚‹ï¼Ÿ</li>
<li><code>(priority, task)</code>ã§ã€<code>task</code>ãŒæ¯”è¼ƒä¸èƒ½ã ã¨å£Šã‚Œã‚‹</li>
<li>æ—¢å­˜ã‚¿ã‚¹ã‚¯ã®å„ªå…ˆåº¦å¤‰æ›´ã‚„å‰Šé™¤ã‚’ã©ã†æ‰±ã†ï¼Ÿ</li>
</ul>
<p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¨å¥¨ã®å®šç•ªã¯<code>[priority, counter, task]</code>ã§ã€<code>counter</code>ã‚’åŒç‚¹æ±ºå‹ã®ä¸€æ„IDã«ã—ã€å‰Šé™¤ã¯ã€Œå¢“çŸ³ï¼ˆREMOVEDï¼‰ã§ç„¡åŠ¹åŒ–ã€ã—ã¦é…å»¶é™¤å»ã™ã‚‹æ–¹å¼ã€‚</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> heapq</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> itertools</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">pq </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#F8F8F2">entry_finder </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> {}</span></span>
<span class="line"><span style="color:#AE81FF">REMOVED</span><span style="color:#F92672"> =</span><span style="color:#E6DB74"> "&#x3C;removed>"</span></span>
<span class="line"><span style="color:#F8F8F2">counter </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> itertools.count()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> add_task</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">task</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">priority</span><span style="color:#F92672">=</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> task </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> entry_finder:</span></span>
<span class="line"><span style="color:#F8F8F2">        remove_task(task)</span></span>
<span class="line"><span style="color:#F8F8F2">    count </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> next</span><span style="color:#F8F8F2">(counter)</span></span>
<span class="line"><span style="color:#F8F8F2">    entry </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [priority, count, task]</span></span>
<span class="line"><span style="color:#F8F8F2">    entry_finder[task] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> entry</span></span>
<span class="line"><span style="color:#F8F8F2">    heapq.heappush(pq, entry)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> remove_task</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">task</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    entry </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> entry_finder.pop(task)</span></span>
<span class="line"><span style="color:#F8F8F2">    entry[</span><span style="color:#F92672">-</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> REMOVED</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> pop_task</span><span style="color:#F8F8F2">():</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> pq:</span></span>
<span class="line"><span style="color:#F8F8F2">        priority, count, task </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapq.heappop(pq)</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> task </span><span style="color:#F92672">is</span><span style="color:#F92672"> not</span><span style="color:#AE81FF"> REMOVED</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">            del</span><span style="color:#F8F8F2"> entry_finder[task]</span></span>
<span class="line"><span style="color:#F92672">            return</span><span style="color:#F8F8F2"> task</span></span>
<span class="line"><span style="color:#F92672">    raise</span><span style="color:#66D9EF;font-style:italic"> KeyError</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"pop from an empty priority queue"</span><span style="color:#F8F8F2">)</span></span></code></pre>
<h2 id="å…·ä½“ä¾‹3-ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®è¤‡æ•°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒãƒ¼ã‚¸heapqmerge">å…·ä½“ä¾‹3: ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®è¤‡æ•°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒãƒ¼ã‚¸ï¼ˆheapq.mergeï¼‰<a aria-hidden="true" tabindex="-1" href="#å…·ä½“ä¾‹3-ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®è¤‡æ•°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒãƒ¼ã‚¸heapqmerge"><span class="icon icon-link"></span></a></h2>
<p><code>heapq.merge(*iterables, key=None, reverse=False)</code>ã¯ã€å…¥åŠ›ãŒã™ã§ã«ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’å‰æã«ã€å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«è¼‰ã›ãšã«ãƒãƒ¼ã‚¸çµæœã‚’è¿”ã™ï¼ˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼‰ã€‚</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> heapq</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">a </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">4</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">7</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">b </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">3</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">10</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">c </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">5</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">6</span><span style="color:#F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF">print</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF;font-style:italic">list</span><span style="color:#F8F8F2">(heapq.merge(a, b, c)))</span></span>
<span class="line"><span style="color:#88846F"># [0, 1, 2, 3, 4, 5, 6, 7, 10]</span></span></code></pre>
<h2 id="å…·ä½“ä¾‹4-ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ä¸­å¤®å€¤2ãƒ’ãƒ¼ãƒ—">å…·ä½“ä¾‹4: ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ä¸­å¤®å€¤ï¼ˆ2ãƒ’ãƒ¼ãƒ—ï¼‰<a aria-hidden="true" tabindex="-1" href="#å…·ä½“ä¾‹4-ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ä¸­å¤®å€¤2ãƒ’ãƒ¼ãƒ—"><span class="icon icon-link"></span></a></h2>
<p>ä¸­å¤®å€¤ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«æ›´æ–°ã—ãŸã„ã¨ãã¯ã€Œå°ã•ã„å´ã‚’max-heapã€ã€Œå¤§ãã„å´ã‚’min-heapã€ã«åˆ†ã‘ã¦ãƒãƒ©ãƒ³ã‚¹ã™ã‚‹ã®ãŒå®šç•ªã€‚Python 3.14ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚ä¾‹ãŒè¼‰ã£ã¦ã„ã‚‹ï¼ˆ<code>heappush_max</code>ç­‰ã‚’ä½¿ã†ç‰ˆï¼‰ã€‚</p>
<p>ï¼ˆ3.14æœªæº€ãªã‚‰max-heapå´ã‚’è² æ•°åŒ–ã§æŒã¤ã®ãŒä¸€èˆ¬çš„ã€‚ï¼‰</p>
<h2 id="cpythonã®å®Ÿè£…">CPythonã®å®Ÿè£…<a aria-hidden="true" tabindex="-1" href="#cpythonã®å®Ÿè£…"><span class="icon icon-link"></span></a></h2>
<h3 id="å…¨ä½“æ§‹æˆ-pythonãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨cå®Ÿè£…">å…¨ä½“æ§‹æˆ: Pythonãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨Cå®Ÿè£…<a aria-hidden="true" tabindex="-1" href="#å…¨ä½“æ§‹æˆ-pythonãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨cå®Ÿè£…"><span class="icon icon-link"></span></a></h3>
<p><code>heapq</code>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯äºŒå±¤æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã€‚<code>Lib/heapq.py</code>ã«pure Pythonå®Ÿè£…ãŒã‚ã‚Šã€æœ«å°¾ã§</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F92672">try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    from</span><span style="color:#F8F8F2"> _heapq </span><span style="color:#F92672">import</span><span style="color:#F92672"> *</span></span>
<span class="line"><span style="color:#F92672">except</span><span style="color:#66D9EF;font-style:italic"> ImportError</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    pass</span></span></code></pre>
<p>ã¨ã—ã¦Cå®Ÿè£…ï¼ˆ<code>Modules/_heapqmodule.c</code>ï¼‰ã§ä¸Šæ›¸ãã™ã‚‹ã€‚ã¤ã¾ã‚Šé€šå¸¸ã®CPythonã§ã¯Cå®Ÿè£…ãŒä½¿ã‚ã‚Œã€Pythonå®Ÿè£…ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å…¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¨ã„ã†ä½ç½®ä»˜ã‘ã€‚ä»¥ä¸‹ã§ã¯Pythonå®Ÿè£…ã‚’èª­ã¿ãªãŒã‚‰ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æœ¬è³ªã‚’è¿½ã†ã€‚</p>
<h3 id="siftã®å‘½åã«ã¤ã„ã¦">siftã®å‘½åã«ã¤ã„ã¦<a aria-hidden="true" tabindex="-1" href="#siftã®å‘½åã«ã¤ã„ã¦"><span class="icon icon-link"></span></a></h3>
<p>siftã¯è‹±èªã§ã€Œãµã‚‹ã„ã«ã‹ã‘ã‚‹ã€ã¨ã„ã†æ„å‘³ã€‚ç ‚ã‚’ãµã‚‹ã„ã«ã‹ã‘ã¦ç²’ã®å¤§ãã•ã§åˆ†ã‘ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚</p>
<p>CPythonã®å‘½åã¯ç›´æ„Ÿã¨é€†ãªã®ã§æ³¨æ„:</p>
<ul>
<li><code>_siftdown</code>: å¯¾è±¡è¦ç´ ã¯ä¸Šã«ç§»å‹•ã™ã‚‹ã€‚åå‰ã¯ã€Œè¦ªãŒä¸‹ã«ãµã‚‹ã„è½ã¨ã•ã‚Œã‚‹(sift down)ã€ã¨ã„ã†è¦–ç‚¹</li>
<li><code>_siftup</code>: å¯¾è±¡è¦ç´ ã¯ä¸‹ã«ç§»å‹•ã™ã‚‹ã€‚åå‰ã¯ã€Œå­ãŒä¸Šã«ãµã‚‹ã„ä¸Šã’ã‚‰ã‚Œã‚‹(sift up)ã€ã¨ã„ã†è¦–ç‚¹</li>
</ul>
<p>é–¢æ•°åã¯ã€Œæ“ä½œå¯¾è±¡ã€ã§ã¯ãªãã€ŒæŠ¼ã—ã®ã‘ã‚‰ã‚Œã‚‹å‘¨å›²ã®è¦ç´ ã€ã®å‹•ãã‚’è¡¨ã—ã¦ã„ã‚‹ã€‚</p>
<h3 id="_siftdown-è¦ªã‚’ä¸‹ã«ãµã‚‹ã„è½ã¨ã—ã¦è¦ç´ ã‚’æ ¹æ–¹å‘ã¸ä¸Šã’ã‚‹"><code>_siftdown</code>: è¦ªã‚’ä¸‹ã«ãµã‚‹ã„è½ã¨ã—ã¦ã€è¦ç´ ã‚’æ ¹æ–¹å‘ã¸ä¸Šã’ã‚‹<a aria-hidden="true" tabindex="-1" href="#_siftdown-è¦ªã‚’ä¸‹ã«ãµã‚‹ã„è½ã¨ã—ã¦è¦ç´ ã‚’æ ¹æ–¹å‘ã¸ä¸Šã’ã‚‹"><span class="icon icon-link"></span></a></h3>
<p><code>heappush</code>ã®æ ¸ã€‚æŒ‡å®šä½ç½®ã®è¦ç´ ã‚’æ ¹æ–¹å‘ã¸ä¸Šã’ã‚‹ã€‚</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftdown</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">startpos</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#88846F">    # heap[pos]ã®è¦ç´ ã‚’ã€startposã®ä½ç½®ã¾ã§é¡ã£ã¦æ­£ã—ã„ä½ç½®ã«åã‚ã‚‹</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]             </span><span style="color:#88846F"># ç§»å‹•å¯¾è±¡ã‚’é€€é¿ï¼ˆæœ€å¾Œã«1å›ã ã‘æ›¸ãè¾¼ã‚€ï¼‰</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> pos </span><span style="color:#F92672">></span><span style="color:#F8F8F2"> startpos:           </span><span style="color:#88846F"># ä¸Šé™(startpos)ã«é”ã™ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—</span></span>
<span class="line"><span style="color:#F8F8F2">        parentpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> (pos </span><span style="color:#F92672">-</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">) </span><span style="color:#F92672">>></span><span style="color:#AE81FF"> 1</span><span style="color:#88846F">  # è¦ªã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ(pos-1)//2 ã¨åŒã˜ï¼‰</span></span>
<span class="line"><span style="color:#F8F8F2">        parent </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[parentpos]    </span><span style="color:#88846F"># è¦ªã®å€¤ã‚’å–å¾—</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> newitem </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> parent:        </span><span style="color:#88846F"># é€€é¿ã—ãŸå€¤ãŒè¦ªã‚ˆã‚Šå°ã•ã‘ã‚Œã°</span></span>
<span class="line"><span style="color:#F8F8F2">            heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parent      </span><span style="color:#88846F">#   è¦ªã‚’å­ã®ä½ç½®ã«ã‚³ãƒ”ãƒ¼ï¼ˆè¦ªãŒsift downã™ã‚‹ï¼‰</span></span>
<span class="line"><span style="color:#F8F8F2">            pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parentpos         </span><span style="color:#88846F">#   æ³¨ç›®ä½ç½®ã‚’1ã¤ä¸Šã¸</span></span>
<span class="line"><span style="color:#F92672">            continue</span></span>
<span class="line"><span style="color:#F92672">        break</span><span style="color:#88846F">                       # è¦ªä»¥ä¸Šãªã‚‰ã“ã“ãŒæ­£ã—ã„ä½ç½®</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem             </span><span style="color:#88846F"># ç¢ºå®šã—ãŸä½ç½®ã«1å›ã ã‘æ›¸ãè¾¼ã¿</span></span></code></pre>
<p>ç´ æœ´ãªswapæ–¹å¼ã ã¨ãƒ«ãƒ¼ãƒ—1å›ã«ã¤ãä»£å…¥3å›ï¼ˆ<code>tmp=a; a=b; b=tmp</code>ï¼‰ã ãŒã€ã“ã®æ–¹å¼ã¯ã€Œè¦ªã‚’ä¸‹ã‚ã™ã€ä»£å…¥1å› + æœ€å¾Œã®æ›¸ãè¾¼ã¿1å›ã§æ¸ˆã‚€ã€‚</p>
<p>ä¾‹: <code>[1, 2, 3, 5, 4, 7]</code>ã«<code>0</code>ã‚’push â†’ appendå¾Œ<code>[1, 2, 3, 5, 4, 7, 0]</code>ã€<code>_siftdown(heap, 0, 6)</code>ãŒå‘¼ã°ã‚Œã‚‹</p>
<p>åˆæœŸçŠ¶æ…‹:</p>
<pre class="mermaid">graph TD
    A["[0] 1"]
    B["[1] 2"]
    C["[2] 3"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]
    G["[6] 0 â† newitemé€€é¿"]
    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- G
    style G fill:#ffcccc</pre>
<p>å®Ÿè¡Œãƒˆãƒ¬ãƒ¼ã‚¹:</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>newitem = 0, pos = 6</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pos=6: è¦ª heap[2]=3ã€‚0 &#x3C; 3 â†’ heap[6]=3 ã«ä¸Šæ›¸ãã€pos=2 ã¸</span></span>
<span class="line"><span>pos=2: è¦ª heap[0]=1ã€‚0 &#x3C; 1 â†’ heap[2]=1 ã«ä¸Šæ›¸ãã€pos=0 ã¸</span></span>
<span class="line"><span>pos=0: startpos=0 ã«åˆ°é” â†’ ãƒ«ãƒ¼ãƒ—çµ‚äº†</span></span>
<span class="line"><span>heap[0] = 0 ã‚’æ›¸ãè¾¼ã¿</span></span></code></pre>
<p>å®Œäº†å¾Œ:</p>
<pre class="mermaid">graph TD
    A["[0] 0 â† newitemæ›¸ãè¾¼ã¿"]
    B["[1] 2"]
    C["[2] 1"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]
    G["[6] 3"]
    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- G
    style A fill:#ccffcc</pre>
<p>è¦ªã®<code>1</code>ã¨<code>3</code>ãŒãã‚Œãã‚Œ1æ®µãšã¤ä¸‹ã«ãšã‚Œï¼ˆsift downï¼‰ã€ç©ºã„ãŸæ ¹ã®ä½ç½®ã«<code>newitem=0</code>ãŒåã¾ã£ãŸã€‚</p>
<h3 id="_siftup-å­ã‚’ä¸Šã«ãµã‚‹ã„ä¸Šã’ã¦è¦ç´ ã‚’è‘‰æ–¹å‘ã¸ä¸‹ã’ã‚‹--knuthã®æœ€é©åŒ–"><code>_siftup</code>: å­ã‚’ä¸Šã«ãµã‚‹ã„ä¸Šã’ã¦ã€è¦ç´ ã‚’è‘‰æ–¹å‘ã¸ä¸‹ã’ã‚‹ â€” Knuthã®æœ€é©åŒ–<a aria-hidden="true" tabindex="-1" href="#_siftup-å­ã‚’ä¸Šã«ãµã‚‹ã„ä¸Šã’ã¦è¦ç´ ã‚’è‘‰æ–¹å‘ã¸ä¸‹ã’ã‚‹--knuthã®æœ€é©åŒ–"><span class="icon icon-link"></span></a></h3>
<p><code>heappop</code>ã®æ ¸ã€‚æŒ‡å®šä½ç½®ã®è¦ç´ ã‚’è‘‰æ–¹å‘ã¸ä¸‹ã’ã‚‹ã€‚2ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ã€‚</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftup</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    endpos </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(heap)              </span><span style="color:#88846F"># ãƒ’ãƒ¼ãƒ—ã®é•·ã•ï¼ˆå­ãŒã“ã‚Œä»¥ä¸Šãªã‚‰å­˜åœ¨ã—ãªã„ï¼‰</span></span>
<span class="line"><span style="color:#F8F8F2">    startpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> pos                  </span><span style="color:#88846F"># é–‹å§‹ä½ç½®ã‚’è¨˜æ†¶ï¼ˆãƒ•ã‚§ãƒ¼ã‚º2ã®ä¸Šé™ã«ä½¿ã†ï¼‰</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]             </span><span style="color:#88846F"># ç§»å‹•å¯¾è±¡ã‚’é€€é¿</span></span>
<span class="line"><span style="color:#88846F">    # === ãƒ•ã‚§ãƒ¼ã‚º1: newitemã‚’ç„¡è¦–ã—ã¦ã€å°ã•ã„å­ã‚’è‘‰ã¾ã§å¼•ãä¸Šã’ã‚‹ ===</span></span>
<span class="line"><span style="color:#F8F8F2">    childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span><span style="color:#88846F">            # å·¦ã®å­ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos:        </span><span style="color:#88846F"># å­ãŒå­˜åœ¨ã™ã‚‹é–“</span></span>
<span class="line"><span style="color:#F8F8F2">        rightpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span><span style="color:#88846F">     # å³ã®å­ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> rightpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos </span><span style="color:#F92672">and</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> heap[childpos] </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> heap[rightpos]:</span></span>
<span class="line"><span style="color:#F8F8F2">            childpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> rightpos     </span><span style="color:#88846F"># å·¦å³ã§å°ã•ã„æ–¹ã‚’é¸ã¶</span></span>
<span class="line"><span style="color:#F8F8F2">        heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[childpos]  </span><span style="color:#88846F"># å°ã•ã„å­ã‚’è¦ªã®ä½ç½®ã«å¼•ãä¸Šã’ï¼ˆå­ãŒsift upã™ã‚‹ï¼‰</span></span>
<span class="line"><span style="color:#F8F8F2">        pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos              </span><span style="color:#88846F"># æ³¨ç›®ä½ç½®ã‚’ãã®å­ã«ç§»å‹•</span></span>
<span class="line"><span style="color:#F8F8F2">        childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span><span style="color:#88846F">        # æ¬¡ã®å·¦ã®å­</span></span>
<span class="line"><span style="color:#88846F">    # === ãƒ•ã‚§ãƒ¼ã‚º2: è‘‰ã«newitemã‚’ä»®ç½®ãã—ã€æ­£ã—ã„ä½ç½®ã¾ã§ä¸Šã«æˆ»ã™ ===</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem             </span><span style="color:#88846F"># è‘‰ã«newitemã‚’ä»®ç½®ã</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftdown(heap, startpos, pos)  </span><span style="color:#88846F"># startposã¾ã§ã®ç¯„å›²ã§ä¸Šæ–¹å‘ã«èª¿æ•´</span></span></code></pre>
<ul>
<li>ãƒ•ã‚§ãƒ¼ã‚º1: <code>newitem</code>ã¨ã®æ¯”è¼ƒã‚’ä¸€åˆ‡ã›ãšã€å°ã•ã„å­ã‚’ç„¡æ¡ä»¶ã«å¼•ãä¸Šã’ãªãŒã‚‰è‘‰ã¾ã§çªãé€²ã‚€ã€‚ãƒ«ãƒ¼ãƒ—1å›ã®æ¯”è¼ƒã¯ã€Œå·¦å³ã®å­ã®æ¯”è¼ƒã€ã®1å›ã ã‘</li>
<li>ãƒ•ã‚§ãƒ¼ã‚º2: è‘‰ã«ä»®ç½®ãã—ãŸ<code>newitem</code>ã‚’<code>_siftdown</code>ã§æ­£ã—ã„ä½ç½®ã¾ã§æˆ»ã™</li>
</ul>
<p>æ•™ç§‘æ›¸æ–¹å¼ã ã¨ãƒ«ãƒ¼ãƒ—1å›ã«ã¤ãã€Œå­åŒå£«ã®æ¯”è¼ƒã€+ã€Œnewitemã¨å­ã®æ¯”è¼ƒã€= 2å›ã®æ¯”è¼ƒãŒå¿…è¦ã ãŒã€CPythonæ–¹å¼ã¯ãƒ•ã‚§ãƒ¼ã‚º1ã§1å›ã ã‘ã€‚<code>heappop</code>ã§æ ¹ã«æ¥ã‚‹ã®ã¯æœ«å°¾ã®è¦ç´ ï¼ˆå¤§ãã„å‚¾å‘ï¼‰ãªã®ã§ã©ã†ã›è‘‰è¿‘ãã¾ã§è½ã¡ã‚‹ â†’ é€”ä¸­ã§æ¯”è¼ƒã—ã¦ã‚‚ç„¡é§„ã«ãªã‚‹ã“ã¨ãŒå¤šã„ï¼ˆKnuth, Volume 3ï¼‰ã€‚</p>
<p>ä¾‹: <code>[1, 3, 2, 5, 4, 7, 6]</code>ã‹ã‚‰pop â†’ æ ¹<code>1</code>ã‚’è¿”ã—ã€æœ«å°¾<code>6</code>ã‚’æ ¹ã«ç½®ã â†’ <code>_siftup(heap, 0)</code>ãŒå‘¼ã°ã‚Œã‚‹</p>
<p>åˆæœŸçŠ¶æ…‹ï¼ˆ<code>6</code>ã‚’æ ¹ã«ä»®ç½®ãï¼‰:</p>
<pre class="mermaid">graph TD
    A["[0] 6 â† newitemé€€é¿"]
    B["[1] 3"]
    C["[2] 2"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]
    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- G:::hidden
    classDef hidden display:none
    style A fill:#ffcccc</pre>
<p>ãƒ•ã‚§ãƒ¼ã‚º1å®Ÿè¡Œãƒˆãƒ¬ãƒ¼ã‚¹:</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>newitem = 6, pos = 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pos=0: å­ã¯ heap[1]=3, heap[2]=2ã€‚å°ã•ã„æ–¹ 2 ã‚’å¼•ãä¸Šã’ â†’ heap[0]=2, pos=2</span></span>
<span class="line"><span>pos=2: å­ã¯ heap[5]=7 ã®ã¿ã€‚å¼•ãä¸Šã’ â†’ heap[2]=7, pos=5</span></span>
<span class="line"><span>pos=5: å­ãªã—ï¼ˆè‘‰ï¼‰â†’ ãƒ«ãƒ¼ãƒ—çµ‚äº†</span></span>
<span class="line"><span>heap[5] = newitem = 6 ã‚’ä»®ç½®ã</span></span></code></pre>
<p>ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†å¾Œ: <code>[2, 3, 7, 5, 4, 6]</code></p>
<pre class="mermaid">graph TD
    A["[0] 2"]
    B["[1] 3"]
    C["[2] 7 â† å­ãŒä¸ŠãŒã£ãŸ"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 6 â† newitemä»®ç½®ã"]
    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- G:::hidden
    classDef hidden display:none
    style C fill:#ffcccc
    style F fill:#ffcccc</pre>
<p>7ãŒindex 2ã«ä¸ŠãŒã£ã¦ã„ã‚‹ãŒã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn><mo>></mo><mn>6</mn></mrow><annotation encoding="application/x-tex">7 > 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">7</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span> ãªã®ã§ãƒ’ãƒ¼ãƒ—æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ãªã„ã€‚ãƒ•ã‚§ãƒ¼ã‚º1ã¯æ­£ã—ã•ã‚’æ°—ã«ã›ãšè‘‰ã¾ã§çªãé€²ã‚€ãŸã‚ã€ã“ã†ã—ãŸä¸€æ™‚çš„ãªä¸æ•´åˆãŒç”Ÿã˜ã‚‹ã€‚</p>
<p>ãƒ•ã‚§ãƒ¼ã‚º2: <code>_siftdown(heap, 0, 5)</code>ã§<code>6</code>ã‚’æ­£ã—ã„ä½ç½®ã¸</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>pos=5: è¦ª heap[2]=7ã€‚6 &#x3C; 7 â†’ heap[5]=7, pos=2</span></span>
<span class="line"><span>pos=2: è¦ª heap[0]=2ã€‚6 &#x3C; 2? No â†’ ãƒ«ãƒ¼ãƒ—çµ‚äº†</span></span>
<span class="line"><span>heap[2] = 6 ã‚’æ›¸ãè¾¼ã¿</span></span></code></pre>
<p>å®Œäº†å¾Œ: <code>[2, 3, 6, 5, 4, 7]</code></p>
<pre class="mermaid">graph TD
    A["[0] 2"]
    B["[1] 3"]
    C["[2] 6 â† æ­£ã—ã„ä½ç½®"]
    D["[3] 5"]
    E["[4] 4"]
    F["[5] 7"]
    A --- B
    A --- C
    B --- D
    B --- E
    C --- F
    C --- G:::hidden
    classDef hidden display:none
    style C fill:#ccffcc</pre>
<p>ãƒ•ã‚§ãƒ¼ã‚º1ã§èª¤ã£ã¦ä¸ŠãŒã£ãŸ<code>7</code>ãŒã€ãƒ•ã‚§ãƒ¼ã‚º2ã§<code>6</code>ã¨å…¥ã‚Œæ›¿ã‚ã£ã¦æ­£ã—ã„ä½ç½®ã«æˆ»ã£ãŸã€‚ãƒ•ã‚§ãƒ¼ã‚º2ã®<code>_siftdown</code>ã¯1æ®µä¸ŠãŒã‚‹ã ã‘ã§æ¸ˆã‚“ã§ãŠã‚Šã€ãƒ•ãƒ«ã«æ¯”è¼ƒã™ã‚‹ã‚ˆã‚ŠåŠ¹ç‡çš„ã€‚</p>
<p>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆn=1000ã®ãƒ©ãƒ³ãƒ€ãƒ é…åˆ—ï¼‰:</p>




















<table><thead><tr><th>æ“ä½œ</th><th>æ•™ç§‘æ›¸æ–¹å¼</th><th>CPythonæ–¹å¼</th></tr></thead><tbody><tr><td>heapify</td><td>~1,850</td><td>~1,660</td></tr><tr><td>1000å›heappop</td><td>~15,000</td><td>~8,690</td></tr></tbody></table>
<h3 id="heapify-ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—æ§‹ç¯‰ãŒonã«ãªã‚‹ç†ç”±"><code>heapify</code>: ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—æ§‹ç¯‰ãŒO(n)ã«ãªã‚‹ç†ç”±<a aria-hidden="true" tabindex="-1" href="#heapify-ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—æ§‹ç¯‰ãŒonã«ãªã‚‹ç†ç”±"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heapify</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">x</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    n </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(x)</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> reversed</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(n</span><span style="color:#F92672">//</span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">)):</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup(x, i)</span></span></code></pre>
<p><code>n//2</code>ã‹ã‚‰0ã¾ã§é€†é †ã«<code>_siftup</code>ã‚’å‘¼ã¶ã€‚ã“ã‚ŒãŒO(n)ã«ãªã‚‹ç›´æ„Ÿ:</p>
<ul>
<li>è‘‰ï¼ˆå…¨ä½“ã®ç´„åŠåˆ†ï¼‰ã¯å‡¦ç†ä¸è¦</li>
<li>è‘‰ã®1ã¤ä¸Šã®å±¤ï¼ˆç´„n/4å€‹ï¼‰ã¯é«˜ã•1ã—ã‹ä¸‹ãŒã‚‰ãªã„</li>
<li>æ ¹ã«è¿‘ã„ã»ã©æ·±ãä¸‹ãŒã‚‹ãŒã€ãã®å±¤ã®ãƒãƒ¼ãƒ‰æ•°ã¯å°‘ãªã„</li>
<li>åˆè¨ˆ: <code>n/4 * 1 + n/8 * 2 + n/16 * 3 + ... â‰ˆ n</code>ï¼ˆç­‰æ¯”Ã—ç­‰å·®ç´šæ•°ã®å’Œï¼‰</li>
</ul>
<p>ä¸€æ–¹ã€Œ1å€‹ãšã¤<code>heappush</code>ã™ã‚‹ã€æ–¹å¼ã¯O(n log n)ã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚‚ã€Œheapify() is more efficient, when you can use itã€ã¨ã‚ã‚‹ã€‚</p>
<h3 id="heappushpopã¨heapreplace-ãªãœåˆ†ã‘ã¦ã„ã‚‹ã‹"><code>heappushpop</code>ã¨<code>heapreplace</code>: ãªãœåˆ†ã‘ã¦ã„ã‚‹ã‹<a aria-hidden="true" tabindex="-1" href="#heappushpopã¨heapreplace-ãªãœåˆ†ã‘ã¦ã„ã‚‹ã‹"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappushpop</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> heap </span><span style="color:#F92672">and</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> item:</span></span>
<span class="line"><span style="color:#F8F8F2">        item, heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">], item</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heapreplace</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    returnitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftup(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> returnitem</span></span></code></pre>
<ul>
<li><code>heappushpop</code>: ã€Œpushã—ã¦ã‹ã‚‰popã€ã¨ç­‰ä¾¡ã€‚<code>item</code>ãŒç¾åœ¨ã®æœ€å°ä»¥ä¸‹ãªã‚‰ã€pushç›´å¾Œã«ãã®ã¾ã¾è¿”ã£ã¦ãã‚‹ã®ã§<code>_siftup</code>ã™ã‚‰ä¸è¦ï¼ˆçŸ­çµ¡ï¼‰ã€‚<code>nlargest</code>ã§ä½¿ã‚ã‚Œã‚‹</li>
<li><code>heapreplace</code>: ã€Œpopã—ã¦ã‹ã‚‰pushã€ã¨ç­‰ä¾¡ã€‚å…ˆã«popã™ã‚‹ã®ã§ã€è¿”ã‚‹å€¤ãŒ<code>item</code>ã‚ˆã‚Šå¤§ãã„å ´åˆãŒã‚ã‚‹ã€‚<code>nsmallest</code>ã‚„ã‚µã‚¤ã‚ºå›ºå®šãƒ’ãƒ¼ãƒ—ã§ä½¿ã‚ã‚Œã‚‹</li>
</ul>
<p>ã©ã¡ã‚‰ã‚‚ã€Œpush + popã‚’åˆ¥ã€…ã«å‘¼ã¶ã€ã‚ˆã‚Š<code>_siftup</code>ãŒ1å›ã§æ¸ˆã‚€ãŸã‚åŠ¹ç‡çš„ã€‚</p>
<h3 id="nsmallestnlargest-3ã¤ã®æˆ¦ç•¥"><code>nsmallest</code>/<code>nlargest</code>: 3ã¤ã®æˆ¦ç•¥<a aria-hidden="true" tabindex="-1" href="#nsmallestnlargest-3ã¤ã®æˆ¦ç•¥"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> nsmallest</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">n</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">iterable</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> n </span><span style="color:#F92672">==</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> [</span><span style="color:#66D9EF">min</span><span style="color:#F8F8F2">(iterable, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">key)]     </span><span style="color:#88846F"># æˆ¦ç•¥1: min()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        size </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F92672">    except</span><span style="color:#F8F8F2"> (</span><span style="color:#66D9EF;font-style:italic">TypeError</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF;font-style:italic">AttributeError</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F92672">        pass</span></span>
<span class="line"><span style="color:#F92672">    else</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> n </span><span style="color:#F92672">>=</span><span style="color:#F8F8F2"> size:</span></span>
<span class="line"><span style="color:#F92672">            return</span><span style="color:#66D9EF"> sorted</span><span style="color:#F8F8F2">(iterable, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">key)[:n]  </span><span style="color:#88846F"># æˆ¦ç•¥2: sorted()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # æˆ¦ç•¥3: ã‚µã‚¤ã‚ºnã®max-heapã‚’ä½¿ã†</span></span>
<span class="line"><span style="color:#AE81FF">    ...</span></span></code></pre>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>: <code>min()</code>ã§ååˆ†ï¼ˆ1ãƒ‘ã‚¹ã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼‰</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>â‰¥</mo><mtext>size</mtext></mrow><annotation encoding="application/x-tex">n \geq \text{size}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6679em;"></span><span class="mord text"><span class="mord">size</span></span></span></span></span>: å…¨éƒ¨å¿…è¦ãªã®ã§<code>sorted()</code>ã®ã»ã†ãŒåŠ¹ç‡çš„ï¼ˆTimsortã¯å®Ÿãƒ‡ãƒ¼ã‚¿ã«å¼·ã„ï¼‰</li>
<li>ãã‚Œä»¥å¤–: ã‚µã‚¤ã‚º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>ã®max-heapã‚’ç¶­æŒã—ã€ç¾åœ¨ã®Top-nã‚ˆã‚Šå°ã•ã„å€¤ãŒæ¥ãŸã‚‰å…¥ã‚Œæ›¿ãˆã€‚ãƒ¡ãƒ¢ãƒª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ã§ã€å·¨å¤§ãªã‚¤ãƒ†ãƒ©ãƒ–ãƒ«ã«å¯¾å¿œã§ãã‚‹</li>
</ul>
<p><code>nsmallest</code>ã§max-heapã‚’ä½¿ã†ã®ã¯ã€ŒTop-nã®ä¸­ã§æœ€å¤§ã®ã‚‚ã®ã€ã¨æ–°è¦ç´ ã‚’æ¯”è¼ƒã—ã¦ã€æ–°è¦ç´ ãŒå°ã•ã‘ã‚Œã°å·®ã—æ›¿ãˆã‚‹ãŸã‚ã€‚</p>
<h3 id="merge-ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹k-wayãƒãƒ¼ã‚¸"><code>merge</code>: ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹k-wayãƒãƒ¼ã‚¸<a aria-hidden="true" tabindex="-1" href="#merge-ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã‚‹k-wayãƒãƒ¼ã‚¸"><span class="icon icon-link"></span></a></h3>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> merge</span><span style="color:#F8F8F2">(</span><span style="color:#F92672">*</span><span style="color:#FD971F;font-style:italic">iterables</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">reverse</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    h </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> order, it </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> enumerate</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">map</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">iter</span><span style="color:#F8F8F2">, iterables)):</span></span>
<span class="line"><span style="color:#F92672">        try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#66D9EF">            next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> it.</span><span style="color:#66D9EF">__next__</span></span>
<span class="line"><span style="color:#F8F8F2">            h.append([</span><span style="color:#66D9EF">next</span><span style="color:#F8F8F2">(), order </span><span style="color:#F92672">*</span><span style="color:#F8F8F2"> direction, </span><span style="color:#66D9EF">next</span><span style="color:#F8F8F2">])</span></span>
<span class="line"><span style="color:#F92672">        except</span><span style="color:#66D9EF;font-style:italic"> StopIteration</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">            pass</span></span>
<span class="line"><span style="color:#F8F8F2">    _heapify(h)</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(h) </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">            while</span><span style="color:#AE81FF"> True</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">                value, order, </span><span style="color:#66D9EF">next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> s </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> h[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">                yield</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F8F8F2">                s[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> next</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                _heapreplace(h, s)</span></span>
<span class="line"><span style="color:#F92672">        except</span><span style="color:#66D9EF;font-style:italic"> StopIteration</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">            _heappop(h)</span></span>
<span class="line"><span style="color:#AE81FF">    ...</span></span></code></pre>
<p>è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ:</p>
<ul>
<li>ãƒ’ãƒ¼ãƒ—ã®è¦ç´ ã¯<code>[ç¾åœ¨å€¤, é †åº, nexté–¢æ•°]</code>ã®ãƒªã‚¹ãƒˆï¼ˆã‚¿ãƒ—ãƒ«ã§ã¯ãªããƒªã‚¹ãƒˆï¼‰ã€‚<code>s[0] = next()</code>ã§in-placeæ›´æ–°ã—ã€<code>_heapreplace</code>ã«å†åˆ©ç”¨ã§ãã‚‹</li>
<li><code>order</code>ã¯å…¥åŠ›ã®é †ç•ªã§ã€åŒå€¤ã®ã¨ãå®‰å®šã‚½ãƒ¼ãƒˆã‚’å®Ÿç¾ã™ã‚‹ï¼ˆ<code>direction</code>ã¯<code>reverse</code>æ™‚ã«ç¬¦å·åè»¢ï¼‰</li>
<li>ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãŒæ¯æ¸‡ã™ã‚‹ã¨<code>StopIteration</code>ã‚’æŠ•ã’ã‚‹ã®ã§ã€ãã‚Œã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦<code>_heappop</code>ã§é™¤å»</li>
<li>æ®‹ã‚Š1æœ¬ã«ãªã£ãŸã‚‰<code>yield from</code>ã§ç›´æ¥æµã™ï¼ˆãƒ’ãƒ¼ãƒ—æ“ä½œã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å›é¿ï¼‰</li>
<li>å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªã«è¼‰ã›ãªã„ã€‚å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‹ã‚‰1è¦ç´ ãšã¤ã—ã‹ä¿æŒã—ãªã„ãŸã‚ã€å·¨å¤§ãªã‚½ãƒ¼ãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ¼ã‚¸ãªã©ã«é©ã™ã‚‹</li>
</ul>
<h3 id="cå®Ÿè£…_heapqmodulecã¨ã®é•ã„">Cå®Ÿè£…ï¼ˆ<code>_heapqmodule.c</code>ï¼‰ã¨ã®é•ã„<a aria-hidden="true" tabindex="-1" href="#cå®Ÿè£…_heapqmodulecã¨ã®é•ã„"><span class="icon icon-link"></span></a></h3>
<p>Cå®Ÿè£…ã¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦ã¯Pythonç‰ˆã¨åŒä¸€ã ãŒã€ä»¥ä¸‹ã®ç‚¹ã§é«˜é€Ÿ:</p>
<ul>
<li>é–¢æ•°å‘¼ã³å‡ºã—ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒãªã„ï¼ˆ<code>_siftup</code>/<code>_siftdown</code>ãŒCã®staticã§ç›´æ¥å‘¼ã°ã‚Œã‚‹ï¼‰</li>
<li>Python objectã®å‚ç…§ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã‚’ç›´æ¥æ“ä½œ</li>
<li><code>merge</code>ã¨<code>nsmallest</code>/<code>nlargest</code>ã¯Pythonå®Ÿè£…ã®ã¾ã¾ï¼ˆCåŒ–ã•ã‚Œã¦ã„ãªã„ï¼‰</li>
</ul>
<details>
<summary><a href="https://github.com/python/cpython/blob/3.14/Lib/heapq.py">Lib/heapq.py</a> å…¨æ–‡</summary>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E6DB74">"""Heap queue algorithm (a.k.a. priority queue).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">Heaps are arrays for which a[k] &#x3C;= a[2*k+1] and a[k] &#x3C;= a[2*k+2] for</span></span>
<span class="line"><span style="color:#E6DB74">all k, counting elements from 0.  For the sake of comparison,</span></span>
<span class="line"><span style="color:#E6DB74">non-existing elements are considered to be infinite.  The interesting</span></span>
<span class="line"><span style="color:#E6DB74">property of a heap is that a[0] is always its smallest element.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">Usage:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">heap = []            # creates an empty heap</span></span>
<span class="line"><span style="color:#E6DB74">heappush(heap, item) # pushes a new item on the heap</span></span>
<span class="line"><span style="color:#E6DB74">item = heappop(heap) # pops the smallest item from the heap</span></span>
<span class="line"><span style="color:#E6DB74">item = heap[0]       # smallest item on the heap without popping it</span></span>
<span class="line"><span style="color:#E6DB74">heapify(x)           # transforms list into a heap, in-place, in linear time</span></span>
<span class="line"><span style="color:#E6DB74">item = heappushpop(heap, item) # pushes a new item and then returns</span></span>
<span class="line"><span style="color:#E6DB74">                               # the smallest item; the heap size is unchanged</span></span>
<span class="line"><span style="color:#E6DB74">item = heapreplace(heap, item) # pops and returns smallest item, and adds</span></span>
<span class="line"><span style="color:#E6DB74">                               # new item; the heap size is unchanged</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">Our API differs from textbook heap algorithms as follows:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">- We use 0-based indexing.  This makes the relationship between the</span></span>
<span class="line"><span style="color:#E6DB74">  index for a node and the indexes for its children slightly less</span></span>
<span class="line"><span style="color:#E6DB74">  obvious, but is more suitable since Python uses 0-based indexing.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">- Our heappop() method returns the smallest item, not the largest.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">These two make it possible to view the heap as a regular Python list</span></span>
<span class="line"><span style="color:#E6DB74">without surprises: heap[0] is the smallest item, and heap.sort()</span></span>
<span class="line"><span style="color:#E6DB74">maintains the heap invariant!</span></span>
<span class="line"><span style="color:#E6DB74">"""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F"># Original code by Kevin O'Connor, augmented by Tim Peters and Raymond Hettinger</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">__about__ </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> """Heap queues</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">[explanation by FranÃ§ois Pinard]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">Heaps are arrays for which a[k] &#x3C;= a[2*k+1] and a[k] &#x3C;= a[2*k+2] for</span></span>
<span class="line"><span style="color:#E6DB74">all k, counting elements from 0.  For the sake of comparison,</span></span>
<span class="line"><span style="color:#E6DB74">non-existing elements are considered to be infinite.  The interesting</span></span>
<span class="line"><span style="color:#E6DB74">property of a heap is that a[0] is always its smallest element.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">The strange invariant above is meant to be an efficient memory</span></span>
<span class="line"><span style="color:#E6DB74">representation for a tournament.  The numbers below are 'k', not a[k]:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">                                   0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">                  1                                 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">          3               4                5               6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">      7       8       9       10      11      12      13      14</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">    15 16   17 18   19 20   21 22   23 24   25 26   27 28   29 30</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">In the tree above, each cell 'k' is topping '2*k+1' and '2*k+2'.  In</span></span>
<span class="line"><span style="color:#E6DB74">a usual binary tournament we see in sports, each cell is the winner</span></span>
<span class="line"><span style="color:#E6DB74">over the two cells it tops, and we can trace the winner down the tree</span></span>
<span class="line"><span style="color:#E6DB74">to see all opponents s/he had.  However, in many computer applications</span></span>
<span class="line"><span style="color:#E6DB74">of such tournaments, we do not need to trace the history of a winner.</span></span>
<span class="line"><span style="color:#E6DB74">To be more memory efficient, when a winner is promoted, we try to</span></span>
<span class="line"><span style="color:#E6DB74">replace it by something else at a lower level, and the rule becomes</span></span>
<span class="line"><span style="color:#E6DB74">that a cell and the two cells it tops contain three different items,</span></span>
<span class="line"><span style="color:#E6DB74">but the top cell "wins" over the two topped cells.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">If this heap invariant is protected at all time, index 0 is clearly</span></span>
<span class="line"><span style="color:#E6DB74">the overall winner.  The simplest algorithmic way to remove it and</span></span>
<span class="line"><span style="color:#E6DB74">find the "next" winner is to move some loser (let's say cell 30 in the</span></span>
<span class="line"><span style="color:#E6DB74">diagram above) into the 0 position, and then percolate this new 0 down</span></span>
<span class="line"><span style="color:#E6DB74">the tree, exchanging values, until the invariant is re-established.</span></span>
<span class="line"><span style="color:#E6DB74">This is clearly logarithmic on the total number of items in the tree.</span></span>
<span class="line"><span style="color:#E6DB74">By iterating over all items, you get an O(n ln n) sort.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">A nice feature of this sort is that you can efficiently insert new</span></span>
<span class="line"><span style="color:#E6DB74">items while the sort is going on, provided that the inserted items are</span></span>
<span class="line"><span style="color:#E6DB74">not "better" than the last 0'th element you extracted.  This is</span></span>
<span class="line"><span style="color:#E6DB74">especially useful in simulation contexts, where the tree holds all</span></span>
<span class="line"><span style="color:#E6DB74">incoming events, and the "win" condition means the smallest scheduled</span></span>
<span class="line"><span style="color:#E6DB74">time.  When an event schedules other events for execution, they are</span></span>
<span class="line"><span style="color:#E6DB74">scheduled into the future, so they can easily go into the heap.  So, a</span></span>
<span class="line"><span style="color:#E6DB74">heap is a good structure for implementing schedulers (this is what I</span></span>
<span class="line"><span style="color:#E6DB74">used for my MIDI sequencer :-).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">Various structures for implementing schedulers have been extensively</span></span>
<span class="line"><span style="color:#E6DB74">studied, and heaps are good for this, as they are reasonably speedy,</span></span>
<span class="line"><span style="color:#E6DB74">the speed is almost constant, and the worst case is not much different</span></span>
<span class="line"><span style="color:#E6DB74">than the average case.  However, there are other representations which</span></span>
<span class="line"><span style="color:#E6DB74">are more efficient overall, yet the worst cases might be terrible.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">Heaps are also very useful in big disk sorts.  You most probably all</span></span>
<span class="line"><span style="color:#E6DB74">know that a big sort implies producing "runs" (which are pre-sorted</span></span>
<span class="line"><span style="color:#E6DB74">sequences, whose size is usually related to the amount of CPU memory),</span></span>
<span class="line"><span style="color:#E6DB74">followed by a merging passes for these runs, which merging is often</span></span>
<span class="line"><span style="color:#E6DB74">very cleverly organised[1].  It is very important that the initial</span></span>
<span class="line"><span style="color:#E6DB74">sort produces the longest runs possible.  Tournaments are a good way</span></span>
<span class="line"><span style="color:#E6DB74">to achieve that.  If, using all the memory available to hold a</span></span>
<span class="line"><span style="color:#E6DB74">tournament, you replace and percolate items that happen to fit the</span></span>
<span class="line"><span style="color:#E6DB74">current run, you'll produce runs which are twice the size of the</span></span>
<span class="line"><span style="color:#E6DB74">memory for random input, and much better for input fuzzily ordered.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">Moreover, if you output the 0'th item on disk and get an input which</span></span>
<span class="line"><span style="color:#E6DB74">may not fit in the current tournament (because the value "wins" over</span></span>
<span class="line"><span style="color:#E6DB74">the last output value), it cannot fit in the heap, so the size of the</span></span>
<span class="line"><span style="color:#E6DB74">heap decreases.  The freed memory could be cleverly reused immediately</span></span>
<span class="line"><span style="color:#E6DB74">for progressively building a second heap, which grows at exactly the</span></span>
<span class="line"><span style="color:#E6DB74">same rate the first heap is melting.  When the first heap completely</span></span>
<span class="line"><span style="color:#E6DB74">vanishes, you switch heaps and start a new run.  Clever and quite</span></span>
<span class="line"><span style="color:#E6DB74">effective!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">In a word, heaps are useful memory structures to know.  I use them in</span></span>
<span class="line"><span style="color:#E6DB74">a few applications, and I think it is good to keep a 'heap' module</span></span>
<span class="line"><span style="color:#E6DB74">around. :-)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">--------------------</span></span>
<span class="line"><span style="color:#E6DB74">[1] The disk balancing algorithms which are current, nowadays, are</span></span>
<span class="line"><span style="color:#E6DB74">more annoying than clever, and this is a consequence of the seeking</span></span>
<span class="line"><span style="color:#E6DB74">capabilities of the disks.  On devices which cannot seek, like big</span></span>
<span class="line"><span style="color:#E6DB74">tape drives, the story was quite different, and one had to be very</span></span>
<span class="line"><span style="color:#E6DB74">clever to ensure (far in advance) that each tape movement will be the</span></span>
<span class="line"><span style="color:#E6DB74">most effective possible (that is, will best participate at</span></span>
<span class="line"><span style="color:#E6DB74">"progressing" the merge).  Some tapes were even able to read</span></span>
<span class="line"><span style="color:#E6DB74">backwards, and this was also used to avoid the rewinding time.</span></span>
<span class="line"><span style="color:#E6DB74">Believe me, real good tape sorts were quite spectacular to watch!</span></span>
<span class="line"><span style="color:#E6DB74">From all times, sorting has always been a Great Art! :-)</span></span>
<span class="line"><span style="color:#E6DB74">"""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">__all__ </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E6DB74">'heappush'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'heappop'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'heapify'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'heapreplace'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'heappushpop'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#E6DB74">           'heappush_max'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'heappop_max'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'heapify_max'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'heapreplace_max'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#E6DB74">           'heappushpop_max'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'nlargest'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'nsmallest'</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">'merge'</span><span style="color:#F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappush</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Push item onto heap, maintaining the heap invariant."""</span></span>
<span class="line"><span style="color:#F8F8F2">    heap.append(item)</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftdown(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF">len</span><span style="color:#F8F8F2">(heap)</span><span style="color:#F92672">-</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappop</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Pop the smallest item off the heap, maintaining the heap invariant."""</span></span>
<span class="line"><span style="color:#F8F8F2">    lastelt </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap.pop()    </span><span style="color:#88846F"># raises appropriate IndexError if heap is empty</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> heap:</span></span>
<span class="line"><span style="color:#F8F8F2">        returnitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">        heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> lastelt</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> returnitem</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> lastelt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heapreplace</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Pop and return the current smallest value, and add the new item.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">    This is more efficient than heappop() followed by heappush(), and can be</span></span>
<span class="line"><span style="color:#E6DB74">    more appropriate when using a fixed-size heap.  Note that the value</span></span>
<span class="line"><span style="color:#E6DB74">    returned may be larger than item!  That constrains reasonable uses of</span></span>
<span class="line"><span style="color:#E6DB74">    this routine unless written as part of a conditional replacement:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">        if item > heap[0]:</span></span>
<span class="line"><span style="color:#E6DB74">            item = heapreplace(heap, item)</span></span>
<span class="line"><span style="color:#E6DB74">    """</span></span>
<span class="line"><span style="color:#F8F8F2">    returnitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]    </span><span style="color:#88846F"># raises appropriate IndexError if heap is empty</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftup(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> returnitem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappushpop</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Fast version of a heappush followed by a heappop."""</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> heap </span><span style="color:#F92672">and</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> item:</span></span>
<span class="line"><span style="color:#F8F8F2">        item, heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">], item</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heapify</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">x</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Transform list into a heap, in-place, in O(len(x)) time."""</span></span>
<span class="line"><span style="color:#F8F8F2">    n </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(x)</span></span>
<span class="line"><span style="color:#88846F">    # Transform bottom-up.  The largest index there's any point to looking at</span></span>
<span class="line"><span style="color:#88846F">    # is the largest with a child index in-range, so must have 2*i + 1 &#x3C; n,</span></span>
<span class="line"><span style="color:#88846F">    # or i &#x3C; (n-1)/2.  If n is even = 2*j, this is (2*j-1)/2 = j-1/2 so</span></span>
<span class="line"><span style="color:#88846F">    # j-1 is the largest, which is n//2 - 1.  If n is odd = 2*j+1, this is</span></span>
<span class="line"><span style="color:#88846F">    # (2*j+1-1)/2 = j so j-1 is the largest, and that's again n//2-1.</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> reversed</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(n</span><span style="color:#F92672">//</span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">)):</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup(x, i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappop_max</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Maxheap version of a heappop."""</span></span>
<span class="line"><span style="color:#F8F8F2">    lastelt </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap.pop()    </span><span style="color:#88846F"># raises appropriate IndexError if heap is empty</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> heap:</span></span>
<span class="line"><span style="color:#F8F8F2">        returnitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">        heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> lastelt</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup_max(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> returnitem</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> lastelt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heapreplace_max</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Maxheap version of a heappop followed by a heappush."""</span></span>
<span class="line"><span style="color:#F8F8F2">    returnitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]    </span><span style="color:#88846F"># raises appropriate IndexError if heap is empty</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftup_max(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> returnitem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappush_max</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Maxheap version of a heappush."""</span></span>
<span class="line"><span style="color:#F8F8F2">    heap.append(item)</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftdown_max(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF">len</span><span style="color:#F8F8F2">(heap)</span><span style="color:#F92672">-</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heappushpop_max</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">item</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Maxheap fast version of a heappush followed by a heappop."""</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> heap </span><span style="color:#F92672">and</span><span style="color:#F8F8F2"> item </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]:</span></span>
<span class="line"><span style="color:#F8F8F2">        item, heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">], item</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup_max(heap, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> heapify_max</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">x</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Transform list into a maxheap, in-place, in O(len(x)) time."""</span></span>
<span class="line"><span style="color:#F8F8F2">    n </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(x)</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> reversed</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(n</span><span style="color:#F92672">//</span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">)):</span></span>
<span class="line"><span style="color:#F8F8F2">        _siftup_max(x, i)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F"># 'heap' is a heap at all indices >= startpos, except possibly for pos.  pos</span></span>
<span class="line"><span style="color:#88846F"># is the index of a leaf with a possibly out-of-order value.  Restore the</span></span>
<span class="line"><span style="color:#88846F"># heap invariant.</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftdown</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">startpos</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]</span></span>
<span class="line"><span style="color:#88846F">    # Follow the path to the root, moving parents down until finding a place</span></span>
<span class="line"><span style="color:#88846F">    # newitem fits.</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> pos </span><span style="color:#F92672">></span><span style="color:#F8F8F2"> startpos:</span></span>
<span class="line"><span style="color:#F8F8F2">        parentpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> (pos </span><span style="color:#F92672">-</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">) </span><span style="color:#F92672">>></span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">        parent </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[parentpos]</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> newitem </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> parent:</span></span>
<span class="line"><span style="color:#F8F8F2">            heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parent</span></span>
<span class="line"><span style="color:#F8F8F2">            pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parentpos</span></span>
<span class="line"><span style="color:#F92672">            continue</span></span>
<span class="line"><span style="color:#F92672">        break</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F"># The child indices of heap index pos are already heaps, and we want to make</span></span>
<span class="line"><span style="color:#88846F"># a heap at index pos too.  We do this by bubbling the smaller child of</span></span>
<span class="line"><span style="color:#88846F"># pos up (and so on with that child's children, etc) until hitting a leaf,</span></span>
<span class="line"><span style="color:#88846F"># then using _siftdown to move the oddball originally at index pos into place.</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># We *could* break out of the loop as soon as we find a pos where newitem &#x3C;=</span></span>
<span class="line"><span style="color:#88846F"># both its children, but turns out that's not a good idea, and despite that</span></span>
<span class="line"><span style="color:#88846F"># many books write the algorithm that way.  During a heap pop, the last array</span></span>
<span class="line"><span style="color:#88846F"># element is sifted in, and that tends to be large, so that comparing it</span></span>
<span class="line"><span style="color:#88846F"># against values starting from the root usually doesn't pay (= usually doesn't</span></span>
<span class="line"><span style="color:#88846F"># get us out of the loop early).  See Knuth, Volume 3, where this is</span></span>
<span class="line"><span style="color:#88846F"># explained and quantified in an exercise.</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Cutting the # of comparisons is important, since these routines have no</span></span>
<span class="line"><span style="color:#88846F"># way to extract "the priority" from an array element, so that intelligence</span></span>
<span class="line"><span style="color:#88846F"># is likely to be hiding in custom comparison methods, or in array elements</span></span>
<span class="line"><span style="color:#88846F"># storing (priority, record) tuples.  Comparisons are thus potentially</span></span>
<span class="line"><span style="color:#88846F"># expensive.</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># On random arrays of length 1000, making this change cut the number of</span></span>
<span class="line"><span style="color:#88846F"># comparisons made by heapify() a little, and those made by exhaustive</span></span>
<span class="line"><span style="color:#88846F"># heappop() a lot, in accord with theory.  Here are typical results from 3</span></span>
<span class="line"><span style="color:#88846F"># runs (3 just to demonstrate how small the variance is):</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Compares needed by heapify     Compares needed by 1000 heappops</span></span>
<span class="line"><span style="color:#88846F"># --------------------------     --------------------------------</span></span>
<span class="line"><span style="color:#88846F"># 1837 cut to 1663               14996 cut to 8680</span></span>
<span class="line"><span style="color:#88846F"># 1855 cut to 1659               14966 cut to 8678</span></span>
<span class="line"><span style="color:#88846F"># 1847 cut to 1660               15024 cut to 8703</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Building the heap by using heappush() 1000 times instead required</span></span>
<span class="line"><span style="color:#88846F"># 2198, 2148, and 2219 compares:  heapify() is more efficient, when</span></span>
<span class="line"><span style="color:#88846F"># you can use it.</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># The total compares needed by list.sort() on the same lists were 8627,</span></span>
<span class="line"><span style="color:#88846F"># 8627, and 8632 (this should be compared to the sum of heapify() and</span></span>
<span class="line"><span style="color:#88846F"># heappop() compares):  list.sort() is (unsurprisingly!) more efficient</span></span>
<span class="line"><span style="color:#88846F"># for sorting.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftup</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    endpos </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(heap)</span></span>
<span class="line"><span style="color:#F8F8F2">    startpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> pos</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]</span></span>
<span class="line"><span style="color:#88846F">    # Bubble up the smaller child until hitting a leaf.</span></span>
<span class="line"><span style="color:#F8F8F2">    childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span><span style="color:#88846F">    # leftmost child position</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos:</span></span>
<span class="line"><span style="color:#88846F">        # Set childpos to index of smaller child.</span></span>
<span class="line"><span style="color:#F8F8F2">        rightpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> rightpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos </span><span style="color:#F92672">and</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> heap[childpos] </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> heap[rightpos]:</span></span>
<span class="line"><span style="color:#F8F8F2">            childpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> rightpos</span></span>
<span class="line"><span style="color:#88846F">        # Move the smaller child up.</span></span>
<span class="line"><span style="color:#F8F8F2">        heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[childpos]</span></span>
<span class="line"><span style="color:#F8F8F2">        pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos</span></span>
<span class="line"><span style="color:#F8F8F2">        childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#88846F">    # The leaf at pos is empty now.  Put newitem there, and bubble it up</span></span>
<span class="line"><span style="color:#88846F">    # to its final resting place (by sifting its parents down).</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftdown(heap, startpos, pos)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftdown_max</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">startpos</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    'Maxheap variant of _siftdown'</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]</span></span>
<span class="line"><span style="color:#88846F">    # Follow the path to the root, moving parents down until finding a place</span></span>
<span class="line"><span style="color:#88846F">    # newitem fits.</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> pos </span><span style="color:#F92672">></span><span style="color:#F8F8F2"> startpos:</span></span>
<span class="line"><span style="color:#F8F8F2">        parentpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> (pos </span><span style="color:#F92672">-</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">) </span><span style="color:#F92672">>></span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">        parent </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[parentpos]</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> parent </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> newitem:</span></span>
<span class="line"><span style="color:#F8F8F2">            heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parent</span></span>
<span class="line"><span style="color:#F8F8F2">            pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parentpos</span></span>
<span class="line"><span style="color:#F92672">            continue</span></span>
<span class="line"><span style="color:#F92672">        break</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> _siftup_max</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">heap</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">pos</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    'Maxheap variant of _siftup'</span></span>
<span class="line"><span style="color:#F8F8F2">    endpos </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(heap)</span></span>
<span class="line"><span style="color:#F8F8F2">    startpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> pos</span></span>
<span class="line"><span style="color:#F8F8F2">    newitem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[pos]</span></span>
<span class="line"><span style="color:#88846F">    # Bubble up the larger child until hitting a leaf.</span></span>
<span class="line"><span style="color:#F8F8F2">    childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span><span style="color:#88846F">    # leftmost child position</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos:</span></span>
<span class="line"><span style="color:#88846F">        # Set childpos to index of larger child.</span></span>
<span class="line"><span style="color:#F8F8F2">        rightpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> rightpos </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> endpos </span><span style="color:#F92672">and</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> heap[rightpos] </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> heap[childpos]:</span></span>
<span class="line"><span style="color:#F8F8F2">            childpos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> rightpos</span></span>
<span class="line"><span style="color:#88846F">        # Move the larger child up.</span></span>
<span class="line"><span style="color:#F8F8F2">        heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heap[childpos]</span></span>
<span class="line"><span style="color:#F8F8F2">        pos </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> childpos</span></span>
<span class="line"><span style="color:#F8F8F2">        childpos </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 2</span><span style="color:#F92672">*</span><span style="color:#F8F8F2">pos </span><span style="color:#F92672">+</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#88846F">    # The leaf at pos is empty now.  Put newitem there, and bubble it up</span></span>
<span class="line"><span style="color:#88846F">    # to its final resting place (by sifting its parents down).</span></span>
<span class="line"><span style="color:#F8F8F2">    heap[pos] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> newitem</span></span>
<span class="line"><span style="color:#F8F8F2">    _siftdown_max(heap, startpos, pos)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> merge</span><span style="color:#F8F8F2">(</span><span style="color:#F92672">*</span><span style="color:#FD971F;font-style:italic">iterables</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">reverse</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    '''Merge multiple sorted inputs into a single sorted output.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">    Similar to sorted(itertools.chain(*iterables)) but returns a generator,</span></span>
<span class="line"><span style="color:#E6DB74">    does not pull the data into memory all at once, and assumes that each of</span></span>
<span class="line"><span style="color:#E6DB74">    the input streams is already sorted (smallest to largest).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    >>> </span><span style="color:#E6DB74">list(merge([1,3,5,7], [0,2,4,8], [5,10,15,20], [], [25]))</span></span>
<span class="line"><span style="color:#E6DB74">    [0, 1, 2, 3, 4, 5, 5, 7, 8, 10, 15, 20, 25]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">    If *key* is not None, applies a key function to each element to determine</span></span>
<span class="line"><span style="color:#E6DB74">    its sort order.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    >>> </span><span style="color:#E6DB74">list(merge(['dog', 'horse'], ['cat', 'fish', 'kangaroo'], key=len))</span></span>
<span class="line"><span style="color:#E6DB74">    ['dog', 'cat', 'fish', 'horse', 'kangaroo']</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">    '''</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    h </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#F8F8F2">    h_append </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> h.append</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> reverse:</span></span>
<span class="line"><span style="color:#F8F8F2">        _heapify </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapify_max</span></span>
<span class="line"><span style="color:#F8F8F2">        _heappop </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heappop_max</span></span>
<span class="line"><span style="color:#F8F8F2">        _heapreplace </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapreplace_max</span></span>
<span class="line"><span style="color:#F8F8F2">        direction </span><span style="color:#F92672">=</span><span style="color:#F92672"> -</span><span style="color:#AE81FF">1</span></span>
<span class="line"><span style="color:#F92672">    else</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        _heapify </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapify</span></span>
<span class="line"><span style="color:#F8F8F2">        _heappop </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heappop</span></span>
<span class="line"><span style="color:#F8F8F2">        _heapreplace </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapreplace</span></span>
<span class="line"><span style="color:#F8F8F2">        direction </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> key </span><span style="color:#F92672">is</span><span style="color:#AE81FF"> None</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        for</span><span style="color:#F8F8F2"> order, it </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> enumerate</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">map</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">iter</span><span style="color:#F8F8F2">, iterables)):</span></span>
<span class="line"><span style="color:#F92672">            try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#66D9EF">                next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> it.</span><span style="color:#66D9EF">__next__</span></span>
<span class="line"><span style="color:#F8F8F2">                h_append([</span><span style="color:#66D9EF">next</span><span style="color:#F8F8F2">(), order </span><span style="color:#F92672">*</span><span style="color:#F8F8F2"> direction, </span><span style="color:#66D9EF">next</span><span style="color:#F8F8F2">])</span></span>
<span class="line"><span style="color:#F92672">            except</span><span style="color:#66D9EF;font-style:italic"> StopIteration</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">                pass</span></span>
<span class="line"><span style="color:#F8F8F2">        _heapify(h)</span></span>
<span class="line"><span style="color:#F92672">        while</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(h) </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">            try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">                while</span><span style="color:#AE81FF"> True</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">                    value, order, </span><span style="color:#66D9EF">next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> s </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> h[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">                    yield</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F8F8F2">                    s[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> next</span><span style="color:#F8F8F2">()           </span><span style="color:#88846F"># raises StopIteration when exhausted</span></span>
<span class="line"><span style="color:#F8F8F2">                    _heapreplace(h, s)      </span><span style="color:#88846F"># restore heap condition</span></span>
<span class="line"><span style="color:#F92672">            except</span><span style="color:#66D9EF;font-style:italic"> StopIteration</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">                _heappop(h)                 </span><span style="color:#88846F"># remove empty iterator</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> h:</span></span>
<span class="line"><span style="color:#88846F">            # fast case when only a single iterator remains</span></span>
<span class="line"><span style="color:#F8F8F2">            value, order, </span><span style="color:#66D9EF">next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> h[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">            yield</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F92672">            yield from</span><span style="color:#66D9EF"> next</span><span style="color:#F8F8F2">.__self__</span></span>
<span class="line"><span style="color:#F92672">        return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> order, it </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> enumerate</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">map</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">iter</span><span style="color:#F8F8F2">, iterables)):</span></span>
<span class="line"><span style="color:#F92672">        try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#66D9EF">            next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> it.</span><span style="color:#66D9EF">__next__</span></span>
<span class="line"><span style="color:#F8F8F2">            value </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> next</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            h_append([key(value), order </span><span style="color:#F92672">*</span><span style="color:#F8F8F2"> direction, value, </span><span style="color:#66D9EF">next</span><span style="color:#F8F8F2">])</span></span>
<span class="line"><span style="color:#F92672">        except</span><span style="color:#66D9EF;font-style:italic"> StopIteration</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">            pass</span></span>
<span class="line"><span style="color:#F8F8F2">    _heapify(h)</span></span>
<span class="line"><span style="color:#F92672">    while</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(h) </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">            while</span><span style="color:#AE81FF"> True</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">                key_value, order, value, </span><span style="color:#66D9EF">next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> s </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> h[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">                yield</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F8F8F2">                value </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> next</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                s[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> key(value)</span></span>
<span class="line"><span style="color:#F8F8F2">                s[</span><span style="color:#AE81FF">2</span><span style="color:#F8F8F2">] </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F8F8F2">                _heapreplace(h, s)</span></span>
<span class="line"><span style="color:#F92672">        except</span><span style="color:#66D9EF;font-style:italic"> StopIteration</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">            _heappop(h)</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> h:</span></span>
<span class="line"><span style="color:#F8F8F2">        key_value, order, value, </span><span style="color:#66D9EF">next</span><span style="color:#F92672"> =</span><span style="color:#F8F8F2"> h[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">        yield</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F92672">        yield from</span><span style="color:#66D9EF"> next</span><span style="color:#F8F8F2">.__self__</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F"># Algorithm notes for nlargest() and nsmallest()</span></span>
<span class="line"><span style="color:#88846F"># ==============================================</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Make a single pass over the data while keeping the k most extreme values</span></span>
<span class="line"><span style="color:#88846F"># in a heap.  Memory consumption is limited to keeping k values in a list.</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Measured performance for random inputs:</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F">#                                   number of comparisons</span></span>
<span class="line"><span style="color:#88846F">#    n inputs     k-extreme values  (average of 5 trials)   % more than min()</span></span>
<span class="line"><span style="color:#88846F"># -------------   ----------------  ---------------------   -----------------</span></span>
<span class="line"><span style="color:#88846F">#      1,000           100                  3,317               231.7%</span></span>
<span class="line"><span style="color:#88846F">#     10,000           100                 14,046                40.5%</span></span>
<span class="line"><span style="color:#88846F">#    100,000           100                105,749                 5.7%</span></span>
<span class="line"><span style="color:#88846F">#  1,000,000           100              1,007,751                 0.8%</span></span>
<span class="line"><span style="color:#88846F"># 10,000,000           100             10,009,401                 0.1%</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Theoretical number of comparisons for k smallest of n random inputs:</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Step   Comparisons                  Action</span></span>
<span class="line"><span style="color:#88846F"># ----   --------------------------   ---------------------------</span></span>
<span class="line"><span style="color:#88846F">#  1     1.66 * k                     heapify the first k-inputs</span></span>
<span class="line"><span style="color:#88846F">#  2     n - k                        compare remaining elements to top of heap</span></span>
<span class="line"><span style="color:#88846F">#  3     k * (1 + lg2(k)) * ln(n/k)   replace the topmost value on the heap</span></span>
<span class="line"><span style="color:#88846F">#  4     k * lg2(k) - (k/2)           final sort of the k most extreme values</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Combining and simplifying for a rough estimate gives:</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F">#        comparisons = n + k * (log(k, 2) * log(n/k) + log(k, 2) + log(n/k))</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Computing the number of comparisons for step 3:</span></span>
<span class="line"><span style="color:#88846F"># -----------------------------------------------</span></span>
<span class="line"><span style="color:#88846F"># * For the i-th new value from the iterable, the probability of being in the</span></span>
<span class="line"><span style="color:#88846F">#   k most extreme values is k/i.  For example, the probability of the 101st</span></span>
<span class="line"><span style="color:#88846F">#   value seen being in the 100 most extreme values is 100/101.</span></span>
<span class="line"><span style="color:#88846F"># * If the value is a new extreme value, the cost of inserting it into the</span></span>
<span class="line"><span style="color:#88846F">#   heap is 1 + log(k, 2).</span></span>
<span class="line"><span style="color:#88846F"># * The probability times the cost gives:</span></span>
<span class="line"><span style="color:#88846F">#            (k/i) * (1 + log(k, 2))</span></span>
<span class="line"><span style="color:#88846F"># * Summing across the remaining n-k elements gives:</span></span>
<span class="line"><span style="color:#88846F">#            sum((k/i) * (1 + log(k, 2)) for i in range(k+1, n+1))</span></span>
<span class="line"><span style="color:#88846F"># * This reduces to:</span></span>
<span class="line"><span style="color:#88846F">#            (H(n) - H(k)) * k * (1 + log(k, 2))</span></span>
<span class="line"><span style="color:#88846F"># * Where H(n) is the n-th harmonic number estimated by:</span></span>
<span class="line"><span style="color:#88846F">#            gamma = 0.5772156649</span></span>
<span class="line"><span style="color:#88846F">#            H(n) = log(n, e) + gamma + 1 / (2 * n)</span></span>
<span class="line"><span style="color:#88846F">#   http://en.wikipedia.org/wiki/Harmonic_series_(mathematics)#Rate_of_divergence</span></span>
<span class="line"><span style="color:#88846F"># * Substituting the H(n) formula:</span></span>
<span class="line"><span style="color:#88846F">#            comparisons = k * (1 + log(k, 2)) * (log(n/k, e) + (1/n - 1/k) / 2)</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Worst-case for step 3:</span></span>
<span class="line"><span style="color:#88846F"># ----------------------</span></span>
<span class="line"><span style="color:#88846F"># In the worst case, the input data is reversed sorted so that every new element</span></span>
<span class="line"><span style="color:#88846F"># must be inserted in the heap:</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F">#             comparisons = 1.66 * k + log(k, 2) * (n - k)</span></span>
<span class="line"><span style="color:#88846F">#</span></span>
<span class="line"><span style="color:#88846F"># Alternative Algorithms</span></span>
<span class="line"><span style="color:#88846F"># ----------------------</span></span>
<span class="line"><span style="color:#88846F"># Other algorithms were not used because they:</span></span>
<span class="line"><span style="color:#88846F"># 1) Took much more auxiliary memory,</span></span>
<span class="line"><span style="color:#88846F"># 2) Made multiple passes over the data.</span></span>
<span class="line"><span style="color:#88846F"># 3) Made more comparisons in common cases (small k, large n, semi-random input).</span></span>
<span class="line"><span style="color:#88846F"># See the more detailed comparison of approach at:</span></span>
<span class="line"><span style="color:#88846F"># http://code.activestate.com/recipes/577573-compare-algorithms-for-heapqsmallest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> nsmallest</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">n</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">iterable</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Find the n smallest elements in a dataset.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">    Equivalent to:  sorted(iterable, key=key)[:n]</span></span>
<span class="line"><span style="color:#E6DB74">    """</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # Short-cut for n==1 is to use min()</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> n </span><span style="color:#F92672">==</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        it </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> iter</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F8F8F2">        sentinel </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> object</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        result </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> min</span><span style="color:#F8F8F2">(it, </span><span style="color:#FD971F;font-style:italic">default</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">sentinel, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">key)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> [] </span><span style="color:#F92672">if</span><span style="color:#F8F8F2"> result </span><span style="color:#F92672">is</span><span style="color:#F8F8F2"> sentinel </span><span style="color:#F92672">else</span><span style="color:#F8F8F2"> [result]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # When n>=size, it's faster to use sorted()</span></span>
<span class="line"><span style="color:#F92672">    try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        size </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F92672">    except</span><span style="color:#F8F8F2"> (</span><span style="color:#66D9EF;font-style:italic">TypeError</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF;font-style:italic">AttributeError</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F92672">        pass</span></span>
<span class="line"><span style="color:#F92672">    else</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> n </span><span style="color:#F92672">>=</span><span style="color:#F8F8F2"> size:</span></span>
<span class="line"><span style="color:#F92672">            return</span><span style="color:#66D9EF"> sorted</span><span style="color:#F8F8F2">(iterable, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">key)[:n]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # When key is none, use simpler decoration</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> key </span><span style="color:#F92672">is</span><span style="color:#AE81FF"> None</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        it </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> iter</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#88846F">        # put the range(n) first so that zip() doesn't</span></span>
<span class="line"><span style="color:#88846F">        # consume one too many elements from the iterator</span></span>
<span class="line"><span style="color:#F8F8F2">        result </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [(elem, i) </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> i, elem </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> zip</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(n), it)]</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> result:</span></span>
<span class="line"><span style="color:#F92672">            return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">        heapify_max(result)</span></span>
<span class="line"><span style="color:#F8F8F2">        top </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">][</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">        order </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> n</span></span>
<span class="line"><span style="color:#F8F8F2">        _heapreplace </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapreplace_max</span></span>
<span class="line"><span style="color:#F92672">        for</span><span style="color:#F8F8F2"> elem </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> it:</span></span>
<span class="line"><span style="color:#F92672">            if</span><span style="color:#F8F8F2"> elem </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> top:</span></span>
<span class="line"><span style="color:#F8F8F2">                _heapreplace(result, (elem, order))</span></span>
<span class="line"><span style="color:#F8F8F2">                top, _order </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">                order </span><span style="color:#F92672">+=</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">        result.sort()</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> [elem </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> (elem, order) </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> result]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # General case, slowest method</span></span>
<span class="line"><span style="color:#F8F8F2">    it </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> iter</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F8F8F2">    result </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [(key(elem), i, elem) </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> i, elem </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> zip</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(n), it)]</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> result:</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">    heapify_max(result)</span></span>
<span class="line"><span style="color:#F8F8F2">    top </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">][</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">    order </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> n</span></span>
<span class="line"><span style="color:#F8F8F2">    _heapreplace </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapreplace_max</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> elem </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> it:</span></span>
<span class="line"><span style="color:#F8F8F2">        k </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> key(elem)</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> k </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> top:</span></span>
<span class="line"><span style="color:#F8F8F2">            _heapreplace(result, (k, order, elem))</span></span>
<span class="line"><span style="color:#F8F8F2">            top, _order, _elem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">            order </span><span style="color:#F92672">+=</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">    result.sort()</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> [elem </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> (k, order, elem) </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> result]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> nlargest</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">n</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">iterable</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """Find the n largest elements in a dataset.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">    Equivalent to:  sorted(iterable, key=key, reverse=True)[:n]</span></span>
<span class="line"><span style="color:#E6DB74">    """</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # Short-cut for n==1 is to use max()</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> n </span><span style="color:#F92672">==</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        it </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> iter</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F8F8F2">        sentinel </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> object</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        result </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> max</span><span style="color:#F8F8F2">(it, </span><span style="color:#FD971F;font-style:italic">default</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">sentinel, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">key)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> [] </span><span style="color:#F92672">if</span><span style="color:#F8F8F2"> result </span><span style="color:#F92672">is</span><span style="color:#F8F8F2"> sentinel </span><span style="color:#F92672">else</span><span style="color:#F8F8F2"> [result]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # When n>=size, it's faster to use sorted()</span></span>
<span class="line"><span style="color:#F92672">    try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        size </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F92672">    except</span><span style="color:#F8F8F2"> (</span><span style="color:#66D9EF;font-style:italic">TypeError</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF;font-style:italic">AttributeError</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F92672">        pass</span></span>
<span class="line"><span style="color:#F92672">    else</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> n </span><span style="color:#F92672">>=</span><span style="color:#F8F8F2"> size:</span></span>
<span class="line"><span style="color:#F92672">            return</span><span style="color:#66D9EF"> sorted</span><span style="color:#F8F8F2">(iterable, </span><span style="color:#FD971F;font-style:italic">key</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">key, </span><span style="color:#FD971F;font-style:italic">reverse</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">)[:n]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # When key is none, use simpler decoration</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> key </span><span style="color:#F92672">is</span><span style="color:#AE81FF"> None</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        it </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> iter</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F8F8F2">        result </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [(elem, i) </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> i, elem </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> zip</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">, </span><span style="color:#F92672">-</span><span style="color:#F8F8F2">n, </span><span style="color:#F92672">-</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">), it)]</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> result:</span></span>
<span class="line"><span style="color:#F92672">            return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">        heapify(result)</span></span>
<span class="line"><span style="color:#F8F8F2">        top </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">][</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">        order </span><span style="color:#F92672">=</span><span style="color:#F92672"> -</span><span style="color:#F8F8F2">n</span></span>
<span class="line"><span style="color:#F8F8F2">        _heapreplace </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapreplace</span></span>
<span class="line"><span style="color:#F92672">        for</span><span style="color:#F8F8F2"> elem </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> it:</span></span>
<span class="line"><span style="color:#F92672">            if</span><span style="color:#F8F8F2"> top </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> elem:</span></span>
<span class="line"><span style="color:#F8F8F2">                _heapreplace(result, (elem, order))</span></span>
<span class="line"><span style="color:#F8F8F2">                top, _order </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">                order </span><span style="color:#F92672">-=</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">        result.sort(</span><span style="color:#FD971F;font-style:italic">reverse</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> [elem </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> (elem, order) </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> result]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    # General case, slowest method</span></span>
<span class="line"><span style="color:#F8F8F2">    it </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> iter</span><span style="color:#F8F8F2">(iterable)</span></span>
<span class="line"><span style="color:#F8F8F2">    result </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [(key(elem), i, elem) </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> i, elem </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> zip</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF">range</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">, </span><span style="color:#F92672">-</span><span style="color:#F8F8F2">n, </span><span style="color:#F92672">-</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">), it)]</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> result:</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">    heapify(result)</span></span>
<span class="line"><span style="color:#F8F8F2">    top </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">][</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">    order </span><span style="color:#F92672">=</span><span style="color:#F92672"> -</span><span style="color:#F8F8F2">n</span></span>
<span class="line"><span style="color:#F8F8F2">    _heapreplace </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapreplace</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> elem </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> it:</span></span>
<span class="line"><span style="color:#F8F8F2">        k </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> key(elem)</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> top </span><span style="color:#F92672">&#x3C;</span><span style="color:#F8F8F2"> k:</span></span>
<span class="line"><span style="color:#F8F8F2">            _heapreplace(result, (k, order, elem))</span></span>
<span class="line"><span style="color:#F8F8F2">            top, _order, _elem </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> result[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">            order </span><span style="color:#F92672">-=</span><span style="color:#AE81FF"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">    result.sort(</span><span style="color:#FD971F;font-style:italic">reverse</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> [elem </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> (k, order, elem) </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> result]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F"># If available, use C implementation</span></span>
<span class="line"><span style="color:#F92672">try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    from</span><span style="color:#F8F8F2"> _heapq </span><span style="color:#F92672">import</span><span style="color:#F92672"> *</span></span>
<span class="line"><span style="color:#F92672">except</span><span style="color:#66D9EF;font-style:italic"> ImportError</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F"># For backwards compatibility</span></span>
<span class="line"><span style="color:#F8F8F2">_heappop_max  </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heappop_max</span></span>
<span class="line"><span style="color:#F8F8F2">_heapreplace_max </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapreplace_max</span></span>
<span class="line"><span style="color:#F8F8F2">_heappush_max </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heappush_max</span></span>
<span class="line"><span style="color:#F8F8F2">_heappushpop_max </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heappushpop_max</span></span>
<span class="line"><span style="color:#F8F8F2">_heapify_max </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> heapify_max</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">if</span><span style="color:#F8F8F2"> __name__ </span><span style="color:#F92672">==</span><span style="color:#E6DB74"> "__main__"</span><span style="color:#F8F8F2">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    import</span><span style="color:#F8F8F2"> doctest </span><span style="color:#88846F"># pragma: no cover</span></span>
<span class="line"><span style="color:#66D9EF">    print</span><span style="color:#F8F8F2">(doctest.testmod()) </span><span style="color:#88846F"># pragma: no cover</span></span></code></pre>
</details>
<h2 id="ã¾ã¨ã‚">ã¾ã¨ã‚<a aria-hidden="true" tabindex="-1" href="#ã¾ã¨ã‚"><span class="icon icon-link"></span></a></h2>
<ul>
<li><code>heapq</code>ã¯ã€Œæœ€å°ï¼ˆã‚ã‚‹ã„ã¯æœ€å¤§ï¼‰ã‚’ç´ æ—©ãå–ã‚Šå‡ºã™ã€ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã€å…¨ä½“ã‚½ãƒ¼ãƒˆã¨ã¯åˆ¥ç‰©</li>
<li>åŸºæœ¬æ“ä½œã¯<code>heapify/heappush/heappop</code>ã€peekã¯<code>heap[0]</code></li>
<li>å®Ÿç”¨ä¸Šã¯<code>(priority, counter, item)</code>ã§åŒç‚¹å‡¦ç†ã‚’ä½œã‚‹ã®ãŒé‰„æ¿</li>
<li>Python 3.14ã‹ã‚‰max-heap APIãŒè¿½åŠ ã•ã‚Œã€è² æ•°ãƒˆãƒªãƒƒã‚¯ç„¡ã—ã§ã‚‚æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸ</li>
</ul>
<h2 id="references">References<a aria-hidden="true" tabindex="-1" href="#references"><span class="icon icon-link"></span></a></h2>
<ul>
<li><a href="https://docs.python.org/3/library/heapq.html">https://docs.python.org/3/library/heapq.html</a></li>
</ul>  </div> </article>  </main> <footer class="site-footer"> <p>&copy; 2026 diohabara. MAKE THE WORLD FUN AGAIN</p> </footer> <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script> </body> </html> <script type="module">function m(){document.querySelectorAll(".sidenote").forEach(e=>e.remove()),document.querySelectorAll(".footnotes").forEach(e=>{e.style.display=""});const r=document.querySelector("section.footnotes[data-footnotes]");if(!r)return;const p=r.querySelectorAll('li[id^="user-content-fn-"]');if(p.length===0)return;const f=document.querySelector(".article-content");if(!f)return;const v=window.innerWidth>=1120,g=new Map;p.forEach(e=>{const o=e.id.replace("user-content-fn-","");g.set(o,e)});const y=f.querySelectorAll("a[data-footnote-ref]"),E=[];if(y.forEach(e=>{const c=(e.getAttribute("href")||"").replace("#user-content-fn-",""),t=g.get(c);if(!t)return;const i=e.textContent?.trim()||"";let n=e.closest("p, li, blockquote, h1, h2, h3, h4, h5, h6, div, table, pre");if(!n||!f.contains(n))return;for(;n&&n.parentElement!==f;)if(n=n.parentElement,!n)return;const d=t.cloneNode(!0);d.querySelectorAll("a[data-footnote-backref]").forEach(h=>h.remove());const s=document.createElement("aside");s.className="sidenote",s.setAttribute("role","note"),s.setAttribute("data-footnote-id",c);const u=document.createElement("span");u.className="sidenote-number",u.textContent=i;const l=document.createElement("span");l.className="sidenote-content";const S=d.querySelectorAll("p");S.length>0?S.forEach((h,A)=>{A>0&&l.appendChild(document.createElement("br")),l.appendChild(document.createTextNode(h.textContent||""))}):l.textContent=d.textContent?.trim()||"",s.appendChild(u),s.appendChild(l);let w=n,a=n.nextElementSibling;for(;a&&a.classList.contains("sidenote");)w=a,a=a.nextElementSibling;w.insertAdjacentElement("afterend",s),E.push(s)}),v){let e=0;E.forEach(o=>{const c=o.getBoundingClientRect(),t=window.scrollY,i=c.top+t;if(i<e){const d=e-i;o.style.marginTop=`${d}px`}e=o.getBoundingClientRect().bottom+t+8})}r.style.display="none",document.querySelectorAll("a[data-footnote-ref]").forEach(e=>{const c=(e.getAttribute("href")||"").replace("#user-content-fn-",""),t=document.querySelector(`.sidenote[data-footnote-id="${c}"]`);t&&(e.addEventListener("mouseenter",()=>t.classList.add("sidenote-highlight")),e.addEventListener("mouseleave",()=>t.classList.remove("sidenote-highlight")),e.addEventListener("focus",()=>t.classList.add("sidenote-highlight")),e.addEventListener("blur",()=>t.classList.remove("sidenote-highlight")),e.addEventListener("click",i=>{i.preventDefault(),t.classList.add("sidenote-highlight"),setTimeout(()=>t.classList.remove("sidenote-highlight"),1500)}))})}m();document.addEventListener("astro:after-swap",m);let b=window.innerWidth>=1120;window.addEventListener("resize",()=>{const r=window.innerWidth>=1120;r!==b&&(b=r,m())});</script>