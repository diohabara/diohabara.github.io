<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>Pythonのbisectについて</title><meta name=description content="TL;DR # bisectはソート済み配列に対する二分探索を手軽に使える標準ライブラリ bisect_leftとbisect_rightで挿入位置の基準を使い分ける insortでソートを保ったままの挿入も簡単にできる bisectとは #bisectはソート済みリストに対して二分探索を行い、要素を挿入すべき位置を返 …"><meta name=keywords content='blog,diohabara,hugo,memo,python,algorithm,bisect'><meta property="og:url" content="https://diohabara.github.io/blog/algo-bisect-py/"><meta property="og:type" content="article"><meta property="og:title" content="Pythonのbisectについて"><meta property="og:description" content="TL;DR # bisectはソート済み配列に対する二分探索を手軽に使える標準ライブラリ bisect_leftとbisect_rightで挿入位置の基準を使い分ける insortでソートを保ったままの挿入も簡単にできる bisectとは #bisectはソート済みリストに対して二分探索を行い、要素を挿入すべき位置を返 …"><meta property="og:image" content="https://diohabara.github.io/images/avatar.jpg"><meta property="og:image:secure_url" content="https://diohabara.github.io/images/avatar.jpg"><meta property="article:published_time" content="2026-01-18T17:17:17+09:00"><meta property="article:modified_time" content="2026-01-18T17:17:17+09:00"><meta property="article:author" content="diohabara"><meta property="article:tag" content="memo"><meta property="article:tag" content="python"><meta property="article:tag" content="algorithm"><meta property="article:tag" content="bisect"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Pythonのbisectについて"><meta name=twitter:description content="TL;DR # bisectはソート済み配列に対する二分探索を手軽に使える標準ライブラリ bisect_leftとbisect_rightで挿入位置の基準を使い分ける insortでソートを保ったままの挿入も簡単にできる bisectとは #bisectはソート済みリストに対して二分探索を行い、要素を挿入すべき位置を返 …"><meta name=twitter:site content="@diohabara"><meta name=twitter:creator content="@diohabara"><meta property="twitter:domain" content="https://diohabara.github.io/blog/algo-bisect-py/"><meta property="twitter:url" content="https://diohabara.github.io/blog/algo-bisect-py/"><meta name=twitter:image content="https://diohabara.github.io/images/avatar.jpg"><link rel=canonical href=https://diohabara.github.io/blog/algo-bisect-py/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.7136b4abac7b277aba8bc933917f4602d39a5c44f5590be687244bc86ef4f162.js integrity="sha256-cTa0q6x7J3q6i8kzkX9GAtOaXET1WQvmhyRLyG708WI="></script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"diohabara","url":"https://diohabara.github.io/"},"dateModified":"2026-01-18T17:17:17+09:00","datePublished":"2026-01-18T17:17:17+09:00","description":"TL;DR # bisectはソート済み配列に対する二分探索を手軽に使える標準ライブラリ bisect_leftとbisect_rightで挿入位置の基準を使い分ける insortでソートを保ったままの挿入も簡単にできる bisectとは #bisectはソート済みリストに対して二分探索を行い、要素を挿入すべき位置を返 …","headline":"Pythonのbisectについて","image":{"@type":"ImageObject","url":"https://diohabara.github.io/images/avatar.jpg"},"inLanguage":"ja","keywords":"memo, python, algorithm, bisect","mainEntityOfPage":{"@id":"https://diohabara.github.io/blog/algo-bisect-py/","@type":"WebPage"},"name":"Pythonのbisectについて","publisher":{"@type":"Person","logo":{"@type":"ImageObject","url":"https://diohabara.github.io/images/avatar.jpg"},"name":"diohabara"},"url":"https://diohabara.github.io/blog/algo-bisect-py/","wordCount":799}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://diohabara.github.io/","name":"Home","position":1},{"@type":"ListItem","item":"https://diohabara.github.io/blog/","name":"ブログ","position":2},{"@type":"ListItem","item":"https://diohabara.github.io/blog/algo-bisect-py/","name":"Pythonのbisectについて","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Person","description":"MAKE THE WORLD FUN AGAIN","name":"diohabara","sameAs":["https://twitter.com/diohabara"],"url":"https://diohabara.github.io/"}</script><link rel=stylesheet href=/css/custom.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-JC4F65F0RT"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JC4F65F0RT")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://diohabara.github.io/><img src=/images/avatar.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://diohabara.github.io/>barabara diary</a></div><div class=nav-links><div class=nav-link><a href=https://diohabara.github.io/blog/ aria-label=blog><span data-feather=globe></span> blog</a></div><div class=nav-link><a href=https://diohabara.github.io/compensation/ aria-label=compensation><span data-feather=dollar-sign></span> Compensation</a></div><div class=nav-link><a href=https://diohabara.github.io/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/diohabara/ aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://diohabara.github.io/search/ aria-label=search><span data-feather=search></span> Search</a></div><div class=nav-link><a href=https://diohabara.github.io/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://diohabara.github.io/blog/><span data-feather=globe></span> blog</a></li><li class=nav-item><a href=https://diohabara.github.io/compensation/><span data-feather=dollar-sign></span> Compensation</a></li><li class=nav-item><a href=https://diohabara.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/diohabara/><span data-feather=github></span></a></li><li class=nav-item><a href=https://diohabara.github.io/search/><span data-feather=search></span> Search</a></li><li class=nav-item><a href=https://diohabara.github.io/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Pythonのbisectについて</h1><small role=doc-subtitle></small><p class=post-date>January 18, 2026</p><ul class=post-tags><li class=post-tag><a href=https://diohabara.github.io/tags/memo>memo</a></li><li class=post-tag><a href=https://diohabara.github.io/tags/python>python</a></li><li class=post-tag><a href=https://diohabara.github.io/tags/algorithm>algorithm</a></li><li class=post-tag><a href=https://diohabara.github.io/tags/bisect>bisect</a></li></ul></div><div class=post-content><h2 id=tldr>TL;DR <a href=#tldr>#</a></h2><ul><li><code>bisect</code>はソート済み配列に対する二分探索を手軽に使える標準ライブラリ</li><li><code>bisect_left</code>と<code>bisect_right</code>で挿入位置の基準を使い分ける</li><li><code>insort</code>でソートを保ったままの挿入も簡単にできる</li></ul><h2 id=bisectとは>bisectとは <a href=#bisect%e3%81%a8%e3%81%af>#</a></h2><p><code>bisect</code>はソート済みリストに対して二分探索を行い、要素を挿入すべき位置を返すモジュール。自前で二分探索を書く手間を省ける。基本は以下の2つを覚えるだけで十分。</p><ul><li><code>bisect_left(a, x)</code>はx以上が初めて出現する位置を返す</li><li><code>bisect_right(a, x)</code>はxより大きい値が初めて出現する位置を返す</li></ul><p>同じ値が並ぶ場合の違いはここで決まる。<code>a = [1, 3, 3, 6]</code>なら、<code>x = 3</code>のときに<code>bisect_left</code>は1、<code>bisect_right</code>は3になる。</p><p>アルゴリズムとしてはどちらも二分探索で、比較条件だけが違う。<code>bisect_left</code>は「<code>a[mid] &lt; x</code>なら右へ、そうでなければ左へ」を繰り返して<code>a[i] >= x</code>となる最小のiを探す。<code>bisect_right</code>は「<code>a[mid] &lt;= x</code>なら右へ、そうでなければ左へ」を繰り返して<code>a[i] > x</code>となる最小のiを探す。</p><p><a href=https://github.com/python/cpython/blob/63cc1257db468a368d64c0b968d203a0f4c7303a/Lib/bisect.py>ソースコード</a>は次の通り。</p><details><summary>bisect_leftの実装(標準ライブラリ)</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>bisect_left</span>(a, x, lo<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, hi<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, <span style=color:#f92672>*</span>, key<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#e6db74>&#34;&#34;&#34;Return the index where to insert item x in list a, assuming a is sorted.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#e6db74>    The return value i is such that all e in a[:i] have e &lt; x, and all e in
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#e6db74>    a[i:] have e &gt;= x.  So if x already appears in the list, a.insert(i, x) will
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#e6db74>    insert just before the leftmost x already there.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#e6db74>    Optional args lo (default 0) and hi (default len(a)) bound the
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#e6db74>    slice of a to be searched.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#e6db74>    A custom key function can be supplied to customize the sort order.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#66d9ef>if</span> lo <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#39;lo must be non-negative&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#66d9ef>if</span> hi <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        hi <span style=color:#f92672>=</span> len(a)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#75715e># Note, the comparison uses &#34;&lt;&#34; to match the</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#75715e># __lt__() logic in list.sort() and in heapq.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#66d9ef>if</span> key <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        <span style=color:#66d9ef>while</span> lo <span style=color:#f92672>&lt;</span> hi:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>            mid <span style=color:#f92672>=</span> (lo <span style=color:#f92672>+</span> hi) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>            <span style=color:#66d9ef>if</span> a[mid] <span style=color:#f92672>&lt;</span> x:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>                lo <span style=color:#f92672>=</span> mid <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>                hi <span style=color:#f92672>=</span> mid
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        <span style=color:#66d9ef>while</span> lo <span style=color:#f92672>&lt;</span> hi:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>            mid <span style=color:#f92672>=</span> (lo <span style=color:#f92672>+</span> hi) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>            <span style=color:#66d9ef>if</span> key(a[mid]) <span style=color:#f92672>&lt;</span> x:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>                lo <span style=color:#f92672>=</span> mid <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>                hi <span style=color:#f92672>=</span> mid
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#66d9ef>return</span> lo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#75715e># Overwrite above definitions with a fast C implementation</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    <span style=color:#f92672>from</span> _bisect <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ImportError</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div></details><details><summary>bisect_rightの実装(標準ライブラリ)</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>bisect_right</span>(a, x, lo<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, hi<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, <span style=color:#f92672>*</span>, key<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#e6db74>&#34;&#34;&#34;Return the index where to insert item x in list a, assuming a is sorted.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#e6db74>    The return value i is such that all e in a[:i] have e &lt;= x, and all e in
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#e6db74>    a[i:] have e &gt; x.  So if x already appears in the list, a.insert(i, x) will
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#e6db74>    insert just after the rightmost x already there.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#e6db74>    Optional args lo (default 0) and hi (default len(a)) bound the
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#e6db74>    slice of a to be searched.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#e6db74>    A custom key function can be supplied to customize the sort order.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#66d9ef>if</span> lo <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#39;lo must be non-negative&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#66d9ef>if</span> hi <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        hi <span style=color:#f92672>=</span> len(a)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#75715e># Note, the comparison uses &#34;&lt;&#34; to match the</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#75715e># __lt__() logic in list.sort() and in heapq.</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#66d9ef>if</span> key <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        <span style=color:#66d9ef>while</span> lo <span style=color:#f92672>&lt;</span> hi:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>            mid <span style=color:#f92672>=</span> (lo <span style=color:#f92672>+</span> hi) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>            <span style=color:#66d9ef>if</span> x <span style=color:#f92672>&lt;</span> a[mid]:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>                hi <span style=color:#f92672>=</span> mid
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>                lo <span style=color:#f92672>=</span> mid <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        <span style=color:#66d9ef>while</span> lo <span style=color:#f92672>&lt;</span> hi:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>            mid <span style=color:#f92672>=</span> (lo <span style=color:#f92672>+</span> hi) <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>            <span style=color:#66d9ef>if</span> x <span style=color:#f92672>&lt;</span> key(a[mid]):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>                hi <span style=color:#f92672>=</span> mid
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>                lo <span style=color:#f92672>=</span> mid <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#66d9ef>return</span> lo
</span></span></code></pre></div></details><h2 id=使い方の基本>使い方の基本 <a href=#%e4%bd%bf%e3%81%84%e6%96%b9%e3%81%ae%e5%9f%ba%e6%9c%ac>#</a></h2><p>まずはインデックスが返ってくる挙動を把握する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#f92672>import</span> bisect
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>a <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>9</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e># 二分探索で挿入位置を探す。</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e># bisect_left(a, x) は区間の中央の index を mid として「a[mid] &lt; x なら右、</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#75715e># そうでなければ左」を繰り返し、a[i] &gt;= x となる最小の i を返す。</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#75715e># bisect_right(a, x) は同様に「a[mid] &lt;= x なら右、そうでなければ左」を繰り返し、</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e># a[i] &gt; x となる最小の i を返す。</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#75715e># 返る i は0始まりのインデックスで、a[i]の前に挿入する位置を表す</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#75715e># 例えば i=1 は a[1] の前(つまり a[0] と a[1] の間)。</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e># x=3 のとき</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#75715e># index: 0  1  2  3  4</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#75715e># value: 1  3  3  6  9</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#75715e># left :    ^ (i=1, 最初の 3 の前)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#75715e># right:          ^ (i=3, 2つの 3 の後)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>print(bisect<span style=color:#f92672>.</span>bisect_left(a, <span style=color:#ae81ff>3</span>))   <span style=color:#75715e># 挿入位置のインデックス(左端): 1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>print(bisect<span style=color:#f92672>.</span>bisect_right(a, <span style=color:#ae81ff>3</span>))  <span style=color:#75715e># 挿入位置のインデックス(右端): 3</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#75715e># x=2 のとき</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#75715e># index: 0  1  2  3  4</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#75715e># value: 1  3  3  6  9</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#75715e># left :    ^ (i=1, 1 と最初の 3 の間)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#75715e># right:    ^ (i=1, 1 と最初の 3 の間)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>print(bisect<span style=color:#f92672>.</span>bisect_left(a, <span style=color:#ae81ff>2</span>))   <span style=color:#75715e># 挿入位置のインデックス(左端): 1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>print(bisect<span style=color:#f92672>.</span>bisect_right(a, <span style=color:#ae81ff>2</span>))  <span style=color:#75715e># 挿入位置のインデックス(右端): 1</span>
</span></span></code></pre></div><p>ここで返ってくるインデックスは「xを挿入したときに昇順が保たれる位置」を意味する。例えば<code>a[1]</code>の前に挿入すべきなら1が返る。</p><p><code>3</code>はすでに2つあるので、左端の位置が1、右端の位置が3になる。<code>2</code>は存在しないので、入れられる場所はどちらも1。</p><h2 id=コーナーケース-最小より小さい最大より大きい>コーナーケース: 最小より小さい/最大より大きい <a href=#%e3%82%b3%e3%83%bc%e3%83%8a%e3%83%bc%e3%82%b1%e3%83%bc%e3%82%b9-%e6%9c%80%e5%b0%8f%e3%82%88%e3%82%8a%e5%b0%8f%e3%81%95%e3%81%84%e6%9c%80%e5%a4%a7%e3%82%88%e3%82%8a%e5%a4%a7%e3%81%8d%e3%81%84>#</a></h2><p>対象の値がリストの最小より小さい場合は0、最大より大きい場合は<code>len(a)</code>が返る。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>import</span> bisect
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>a <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>9</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>print(bisect<span style=color:#f92672>.</span>bisect_left(a, <span style=color:#ae81ff>0</span>))   <span style=color:#75715e># 0</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>print(bisect<span style=color:#f92672>.</span>bisect_right(a, <span style=color:#ae81ff>0</span>))  <span style=color:#75715e># 0</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>print(bisect<span style=color:#f92672>.</span>bisect_left(a, <span style=color:#ae81ff>10</span>))  <span style=color:#75715e># 5</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>print(bisect<span style=color:#f92672>.</span>bisect_right(a, <span style=color:#ae81ff>10</span>)) <span style=color:#75715e># 5</span>
</span></span></code></pre></div><p>どちらも「挿入して昇順が保たれる位置」なので、先頭なら0、末尾の次なら<code>len(a)</code>になる。</p><h2 id=具体例1-値が存在するかを高速に調べる>具体例1: 値が存在するかを高速に調べる <a href=#%e5%85%b7%e4%bd%93%e4%be%8b1-%e5%80%a4%e3%81%8c%e5%ad%98%e5%9c%a8%e3%81%99%e3%82%8b%e3%81%8b%e3%82%92%e9%ab%98%e9%80%9f%e3%81%ab%e8%aa%bf%e3%81%b9%e3%82%8b>#</a></h2><p><code>bisect_left</code>で位置を求め、そこが範囲内かつ値が一致すれば存在すると判定できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>import</span> bisect
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>contains</span>(a, x):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    i <span style=color:#f92672>=</span> bisect<span style=color:#f92672>.</span>bisect_left(a, x)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#66d9ef>return</span> i <span style=color:#f92672>&lt;</span> len(a) <span style=color:#f92672>and</span> a[i] <span style=color:#f92672>==</span> x
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>a <span style=color:#f92672>=</span> [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>10</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>print(contains(a, <span style=color:#ae81ff>6</span>))   <span style=color:#75715e># True</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>print(contains(a, <span style=color:#ae81ff>7</span>))   <span style=color:#75715e># False</span>
</span></span></code></pre></div><h2 id=具体例2-スコアのランク分け>具体例2: スコアのランク分け <a href=#%e5%85%b7%e4%bd%93%e4%be%8b2-%e3%82%b9%e3%82%b3%e3%82%a2%e3%81%ae%e3%83%a9%e3%83%b3%e3%82%af%e5%88%86%e3%81%91>#</a></h2><p>閾値の配列を用意して、<code>bisect_right</code>で区分を求める。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#f92672>import</span> bisect
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>grade</span>(score, thresholds, labels):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    idx <span style=color:#f92672>=</span> bisect<span style=color:#f92672>.</span>bisect_right(thresholds, score)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#66d9ef>return</span> labels[idx]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>thresholds <span style=color:#f92672>=</span> [<span style=color:#ae81ff>60</span>, <span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>90</span>]  <span style=color:#75715e># 0-59, 60-69, 70-79, 80-89, 90-100</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>labels <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;F&#34;</span>, <span style=color:#e6db74>&#34;D&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;A&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>print(grade(<span style=color:#ae81ff>58</span>, thresholds, labels))  <span style=color:#75715e># F</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>print(grade(<span style=color:#ae81ff>70</span>, thresholds, labels))  <span style=color:#75715e># C</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>print(grade(<span style=color:#ae81ff>95</span>, thresholds, labels))  <span style=color:#75715e># A</span>
</span></span></code></pre></div><h2 id=具体例3-ソート済みを保って挿入>具体例3: ソート済みを保って挿入 <a href=#%e5%85%b7%e4%bd%93%e4%be%8b3-%e3%82%bd%e3%83%bc%e3%83%88%e6%b8%88%e3%81%bf%e3%82%92%e4%bf%9d%e3%81%a3%e3%81%a6%e6%8c%bf%e5%85%a5>#</a></h2><p><code>insort_left</code>や<code>insort_right</code>を使うと、挿入位置の探索と挿入をまとめて行える。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>import</span> bisect
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>a <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>7</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>bisect<span style=color:#f92672>.</span>insort(a, <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>print(a)  <span style=color:#75715e># [1, 4, 5, 7]</span>
</span></span></code></pre></div><p>注意点として、<code>insort</code>は挿入時にリストの要素をずらすので、1回あたりO(n)のコストがかかる。大量挿入があるなら別のデータ構造も検討したい。</p><h2 id=注意点>注意点 <a href=#%e6%b3%a8%e6%84%8f%e7%82%b9>#</a></h2><p>次に書かれているように<code>bisect_right</code>と<code>insort_right</code>はそれぞれ<code>bisect</code>、<code>insort</code>という別名が付いている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># Create aliases</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>bisect <span style=color:#f92672>=</span> bisect_right
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>insort <span style=color:#f92672>=</span> insort_right
</span></span></code></pre></div><p>つまり<code>insort</code>は「右端に挿入する<code>insort_right</code>の別名」で、同じ値がある場合は右側に追加される。</p><h2 id=まとめ>まとめ <a href=#%e3%81%be%e3%81%a8%e3%82%81>#</a></h2><ul><li><code>bisect_left</code>と<code>bisect_right</code>は挿入位置の境界を選べる</li><li>存在判定や区分の判定にそのまま使える</li><li><code>insort</code>で手軽にソート済みを維持できるがコストはO(n)</li></ul><h2 id=references>References <a href=#references>#</a></h2><ul><li><a href=https://docs.python.org/ja/3/library/bisect.html>https://docs.python.org/ja/3/library/bisect.html</a></li></ul></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer><script src=/js/image-lazy-load.js></script></body></html>